```html
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALINEA - Herramienta para la Formulación y Alineación Estratégica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        /* Estilos Base */
        body { font-family: 'Inter', sans-serif; }
        .input-group > * + * { margin-top: 0.5rem; }
        .btn { padding: 0.5rem 1rem; border-radius: 0.375rem; font-weight: 600; text-align: center; cursor: pointer; transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out; display: inline-flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; }
        .btn-primary { background-color: #2563eb; color: white; border: 1px solid transparent;}
        .btn-primary:hover { background-color: #1d4ed8; }
        .btn-secondary { background-color: #6b7280; color: white; border: 1px solid transparent;}
        .btn-secondary:hover { background-color: #4b5563; }
        .btn-icon { padding: 0.25rem; margin-left: 0.5rem; color: #6b7280; border: none; background: none; cursor: pointer; }
        .btn-icon:hover { color: #1d4ed8; }
        .form-input, .form-textarea { width: 100%; border: 1px solid #d1d5db; border-radius: 0.375rem; padding: 0.5rem 0.75rem; font-size: 0.875rem; line-height: 1.25rem; transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }
        .form-textarea { min-height: 70px; }
        label[data-tooltip] { position: relative; cursor: help; border-bottom: 1px dotted #9ca3af; }
        label[data-tooltip]:hover::after { content: attr(data-tooltip); position: absolute; left: 0; top: 115%; background-color: #374151; color: white; padding: 0.6rem 0.9rem; border-radius: 0.375rem; font-size: 0.8rem; white-space: pre-wrap; width: 300px; z-index: 10; box-shadow: 0 4px 8px rgba(0,0,0,0.2); line-height: 1.4; visibility: hidden; opacity: 0; transition: opacity 0.2s ease-in-out, visibility 0.2s ease-in-out; }
        label[data-tooltip]:hover::after { visibility: visible; opacity: 1; }
        .output-area-container { margin-top: 1.5rem; border: 1px solid #e5e7eb; border-radius: 0.5rem; background-color: #f9fafb; }
        .output-area-header { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1rem; border-bottom: 1px solid #e5e7eb; background-color: #f3f4f6; border-radius: 0.5rem 0.5rem 0 0;}
        .output-area-title { font-weight: 600; color: #374151; }
        .output-area-content-div { padding: 1rem; max-height: 400px; overflow-y: auto; background-color: #ffffff; border-radius: 0 0 0.5rem 0.5rem;}
        .output-area-content-div h3, .output-area-content-div h4, .output-area-content-div h5 { font-family: 'Inter', sans-serif; margin-bottom: 0.5rem; font-weight: 600; margin-top: 1rem; }
        .output-area-content-div h3 { font-size: 1.1rem; margin-top: 0; }
        .output-area-content-div h4 { font-size: 1rem; }
        .output-area-content-div h5 { font-size: 0.95rem; color: #1d4ed8; }
        .output-area-content-div p { font-family: 'Inter', sans-serif; margin-bottom: 0.75rem; white-space: normal; line-height: 1.6; color: #374151;}
        .output-area-content-div ul { font-family: 'Inter', sans-serif; margin-left: 1.5rem; list-style: disc; margin-bottom: 0.75rem; white-space: normal;}
        .output-area-content-div li { margin-bottom: 0.4rem; }
        .output-area-content-div code { background-color: #e5e7eb; padding: 0.1rem 0.3rem; border-radius: 0.25rem; font-size: 0.9em; font-family: monospace; }
        .output-area-content-div strong { font-weight: bold; }
        .output-area-content-div blockquote { border-left: 4px solid #e5e7eb; padding-left: 1rem; margin-left: 0; margin-right: 0; font-style: italic; color: #4b5563; }
        .output-area-content-div .example-list li { margin-bottom: 0.6rem; }
        .output-area-content-div .example-explanation { font-size: 0.8rem; color: #4b5563; margin-left: 0.5rem; }
        .output-area-content-textarea { display: block; width: 100%; height: 300px; overflow-y: auto; font-family: monospace; white-space: pre-wrap; word-wrap: break-word; font-size: 0.85rem; line-height: 1.5; padding: 1rem; border: 1px solid #d1d5db; border-radius: 0 0 0.5rem 0.5rem; background-color: #f9fafb; resize: vertical; }
        .output-area-content-textarea:focus { outline: none; border-color: #a5b4fc; box-shadow: 0 0 0 1px #a5b4fc; }
        i[data-lucide] { width: 1em; height: 1em; display: inline-block; vertical-align: middle; margin-right: 0.3em; }
        .copy-button i[data-lucide], .verb-list-button i[data-lucide], .dynamic-add-button i[data-lucide], .dynamic-remove-button i[data-lucide] { margin-right: 0; }
        .citation { font-size: 0.75rem; color: #6b7280; margin-top: 0.5rem; text-align: right; padding-right: 1rem; padding-bottom: 0.5rem; line-height: 1.3; }
        /* Input highlighting MODIFICADO */
        .input-warning { border-color: #f87171 !important; box-shadow: 0 0 0 1px #f87171; }
        .input-suggestion { border-color: #fbbf24 !important; box-shadow: 0 0 0 1px #fbbf24; }
        .input-positive { border-color: #22c55e !important; box-shadow: 0 0 0 1px #22c55e; } /* Verde para positivo */
        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center; z-index: 1000; visibility: hidden; opacity: 0; transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal-overlay.visible { visibility: visible; opacity: 1; }
        .modal-content { background-color: white; padding: 2rem; border-radius: 0.5rem; max-width: 90%; width: 500px; max-height: 80vh; overflow-y: auto; position: relative; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .modal-close-button { position: absolute; top: 0.75rem; right: 0.75rem; background: none; border: none; cursor: pointer; color: #6b7280; }
        .modal-close-button:hover { color: #1f2937; }
        #modalVerbList { font-size: 0.9rem; line-height: 1.6; color: #374151; }
        #modalVerbList span { display: inline-block; background-color: #e5e7eb; padding: 0.2rem 0.5rem; margin: 0.2rem; border-radius: 0.25rem; }
        /* Dinámico */
        .dynamic-add-button { color: white; font-size: 0.75rem; padding: 0.25rem 0.5rem; border-radius: 0.25rem; margin-top: 0.5rem; display: inline-flex; align-items: center; gap: 0.3em; }
        .dynamic-add-button i[data-lucide] { width: 1em; height: 1em; }
        .dynamic-remove-button { color: #dc2626; font-size: 0.75rem; background: none; border: none; cursor: pointer; padding: 0.1rem; line-height: 1; }
        .dynamic-remove-button:hover { color: #b91c1c; }
        .dynamic-remove-button i[data-lucide] { width: 1.1em; height: 1.1em; vertical-align: middle; }
        .objetivo-block { background-color: #f9fafb; padding: 1rem; margin-bottom: 1rem; border-radius: 0.5rem; border: 1px solid #e5e7eb; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); }
        .estrategia-block { margin-left: 1.5rem; background-color: #ffffff; padding: 0.75rem; margin-top: 0.75rem; border-radius: 0.375rem; border: 1px solid #e5e7eb; }
        .tactica-block { margin-left: 1.5rem; background-color: #f9fafb; padding: 0.5rem; margin-top: 0.5rem; border-radius: 0.25rem; border: 1px solid #f3f4f6; }
        .actividad-block { margin-left: 1.5rem; padding-top: 0.3rem; padding-bottom: 0.3rem; border-top: 1px solid #f3f4f6; margin-top: 0.3rem;}
        .estrategias-container, .tacticas-container, .actividades-container { margin-top: 0.5rem; }
        .optional-field-group { margin-top: 0.5rem; }
        .optional-field-group label { font-size: 0.75rem; color: #4b5563; font-weight: 500; }
        .optional-field-group input { font-size: 0.75rem; padding: 0.25rem 0.5rem; }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 p-4 md:p-8">

    <div class="max-w-4xl mx-auto bg-white p-6 md:p-8 rounded-lg shadow-xl" id="mainAppContainer">

        <h1 class="text-2xl md:text-3xl font-bold text-center text-blue-700 mb-4 flex items-center justify-center gap-2">
             <i data-lucide="target"></i> ALINEA
        </h1>
        <p class="text-center text-gray-600 mb-8">Herramienta para la Formulación y Alineación Estratégica</p>

        <!-- Información General -->
        <div class="mb-6"> <label for="orgName" class="block text-sm font-semibold text-gray-700 mb-1" data-tooltip="Nombre oficial de la organización.">Nombre de la Organización:</label> <input type="text" id="orgName" class="form-input" placeholder="Ej: Innovaciones Educativas Futuro S.A.S."> </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div class="input-group"> <label class="block text-lg font-semibold text-gray-800 mb-2" data-tooltip="Creencias fundamentals y atemporales. No deben iniciar con verbo de acción.">Principios / Valores:</label> <input type="text" id="p1" class="form-input" placeholder="Principio/Valor 1"> <input type="text" id="p2" class="form-input" placeholder="Principio/Valor 2"> <input type="text" id="p3" class="form-input" placeholder="Principio/Valor 3"> </div>
            <div class="input-group"> <label class="block text-lg font-semibold text-gray-800 mb-2" data-tooltip="Directrices o reglas generales para la acción.">Políticas:</label> <input type="text" id="pol1" class="form-input" placeholder="Política 1"> <input type="text" id="pol2" class="form-input" placeholder="Política 2"> <input type="text" id="pol3" class="form-input" placeholder="Política 3"> </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div> <label for="mision" class="block text-lg font-semibold text-gray-800 mb-2" data-tooltip="Razón de ser actual (PRESENTE). Sugerencia: incluir nombre de la organización.">Misión:</label> <textarea id="mision" class="form-textarea" placeholder="Describe la razón de ser actual..."></textarea> </div>
            <div> <label for="vision" class="block text-lg font-semibold text-gray-800 mb-2" data-tooltip="Aspiración futura (FUTURO). Sugerencia: incluir nombre de la organización y año objetivo.">Visión:</label> <textarea id="vision" class="form-textarea" placeholder="Describe la aspiración futura..."></textarea> </div>
        </div>
        <hr class="my-8 border-t border-gray-300">

        <!-- Alineación Estratégica Dinámica -->
        <h2 class="text-xl md:text-2xl font-semibold text-gray-800 mb-6 flex items-center gap-2">
             <i data-lucide="network"></i> Alineación Estratégica
        </h2>
        <div id="objetivosContainer" class="space-y-4">
            <!-- Los objetivos se añadirán aquí dinámicamente -->
        </div>
        <button type="button" onclick="addObjetivo()" class="dynamic-add-button bg-blue-600 hover:bg-blue-700"> <i data-lucide="plus-circle"></i> Añadir Objetivo Estratégico </button>
        <hr class="my-8 border-t border-gray-300">

        <!-- Botón Analizar -->
        <div class="mb-6"> <button id="analyzeButton" class="btn btn-primary w-full sm:w-auto"> <i data-lucide="search-check"></i> Analizar Plan Estratégico </button> <p class="text-sm text-gray-500 mt-2">Haz clic para obtener feedback y ver los resultados en las áreas de abajo.</p> </div>

        <!-- Secciones de Salida -->
        <div id="outputSections" class="space-y-6">
            <div class="output-area-container">
                <div class="output-area-header"> <span class="output-area-title flex items-center gap-2"><i data-lucide="clipboard-check"></i> Análisis y Sugerencias de Mejora</span> <button id="copyFeedbackAreaButton" class="btn btn-secondary btn-sm copy-button" title="Copiar Análisis"> <i data-lucide="copy"></i> </button> </div>
                <textarea id="feedbackArea" class="output-area-content-textarea" readonly style="min-height: 150px;">Haz clic en "Analizar Plan Estratégico" para ver el feedback.</textarea>
                <div id="feedbackFooter" class="citation" style="display: none;"></div>
            </div>
            <div class="output-area-container">
                <div class="output-area-header"> <span class="output-area-title flex items-center gap-2"><i data-lucide="file-text"></i> Plan Estratégico Formulado</span> <button id="copyPlanAreaButton" class="btn btn-secondary btn-sm copy-button" title="Copiar Plan"> <i data-lucide="copy"></i> </button> </div>
                <textarea id="planArea" class="output-area-content-textarea" readonly style="min-height: 200px;">El plan formulado aparecerá aquí después del análisis.</textarea>
                <div id="planFooter" class="citation" style="display: none;"></div>
            </div>
            <div class="output-area-container">
                <div class="output-area-header"> <span class="output-area-title flex items-center gap-2"><i data-lucide="book-marked"></i> Componentes Conceptuales y Diccionario de Verbos</span> <button id="copyConceptualAreaButton" class="btn btn-secondary btn-sm copy-button" title="Copiar Conceptos"> <i data-lucide="copy"></i> </button> </div>
                <div id="conceptualArea" class="output-area-content-div">(El contenido conceptual se cargará aquí...)</div>
            </div>
            <div class="output-area-container">
                <div class="output-area-header"> <span class="output-area-title flex items-center gap-2"><i data-lucide="help-circle"></i> Tutorial de Uso Práctico ALINEA</span> <button id="copyTutorialAreaButton" class="btn btn-secondary btn-sm copy-button" title="Copiar Tutorial"> <i data-lucide="copy"></i> </button> </div>
                <div id="tutorialArea" class="output-area-content-div">(El tutorial de uso se cargará aquí...)</div>
            </div>
        </div>

    </div>

    <!-- Modal -->
    <div id="verbModal" class="modal-overlay"> <div class="modal-content"> <button id="modalCloseButton" class="modal-close-button" title="Cerrar"> <i data-lucide="x"></i> </button> <h3 id="modalTitle" class="text-lg font-semibold mb-4">Verbos Sugeridos</h3> <div id="modalVerbList"> </div> </div> </div>

    <script>
        // --- Constants ---
        const ACTION_VERBS = { /* ... Verbos (sin cambios desde v1.25) ... */
             objetivo: ["afianzar", "alcanzar", "alinear", "analizar", "articular", "asegurar", "concebir", "consolidar", "definir", "determinar", "diagnosticar", "discutir", "diversificar", "establecer", "estimar", "expandir", "facilitar", "fijar", "formar", "formular", "fortalecer", "garantizar", "generar", "idear", "identificar", "impulsar", "incrementar", "innovar", "integrar", "internacionalizar", "introducir", "liderar", "lograr", "modificar", "optimizar", "plantear", "posicionar", "potenciar", "presentar", "priorizar", "promover", "proponer", "proporcionar", "proyectar", "reafirmar", "reconocer", "redefinir", "reducir", "reformular", "reestructurar", "transformar", "desarrollar"],
             estrategia: ["adaptar", "afrontar", "ajustar", "analizar", "asignar", "automatizar", "cambiar", "coordinar", "comparar", "configurar", "confrontar", "delegar", "definir", "desarrollar", "deshacer", "desplegar", "digitalizar", "dirigir", "diseñar", "distribuir", "diversificar", "ejecutar", "encaminar", "enfocar", "establecer", "estimar", "estimular", "evaluar", "examinar", "expandir", "facilitar", "fomentar", "formular", "hacer", "identificar", "implementar", "integrar", "investigar", "mejorar", "modificar", "monitorear", "mover", "operacionalizar", "optimizar", "organizar", "otorgar", "penetrar", "planear", "priorizar", "proponer", "proporcionar", "proyectar", "realizar", "recompensar", "reorganizar", "retroalimentar", "romper", "seleccionar", "supervisar", "traducir", "transferir", "transformar", "vigilar"],
             tactica: ["activar", "adaptar", "adquirir", "administrar", "alinear", "analizar", "articular", "asignar", "asegurar", "capacitar", "comunicar", "consolidar", "construir", "contratar", "controlar", "coordinar", "crear", "definir", "desarrollar", "distribuir", "ejecutar", "elaborar", "establecer", "estandardizar", "estructurar", "evaluar", "gestionar", "implementar", "informar", "integrar", "lanzar", "modificar", "monitorear", "negociar", "optimizar", "organizar", "planificar", "priorizar", "programar", "publicar", "realizar", "regular", "reorganizar", "revisar", "segmentar", "sincronizar", "sistematizar", "supervisar"],
             actividad: ["abastecer", "aceptar", "admitir", "adquirir", "agendar", "ajustar", "almacenar", "analizar", "animar", "aplicar", "archivar", "arreglar", "asignar", "asistir", "atender", "aumentar", "automatizar", "brindar", "calcular", "cambiar", "capacitar", "cargar", "cerrar", "clasificar", "cobrar", "codificar", "colocar", "comercializar", "comprar", "comunicar", "concretar", "conducir", "conseguir", "conservar", "contar", "contactar", "contratar", "controlar", "convertir", "coordinar", "corregir", "cotizar", "crear", "cumplir", "dar", "decidir", "definir", "dejar", "demostrar", "describir", "desarrollar", "descargar", "deshacer", "designar", "detallar", "determinar", "devolver", "difundir", "dirigir", "diseñar", "disminuir", "disponer", "distribuir", "dividir", "documentar", "dotar", "editar", "ejecutar", "elaborar", "elegir", "emitir", "empacar", "empezar", "encontrar", "enfrentar", "entender", "entrar", "entregar", "entrenar", "enviar", "equipar", "escribir", "escuchar", "esperar", "establecer", "estimar", "estudiar", "evaluar", "evitar", "examinar", "exigir", "explicar", "expedir", "fabricar", "facturar", "fijar", "firmar", "formar", "funcionar", "ganar", "gastar", "generar", "gestionar", "grabar", "guardar", "guiar", "hablar", "hacer", "identificar", "implementar", "impulsar", "imprimir", "incluir", "incrementar", "indicar", "informar", "iniciar", "inscribir", "inspeccionar", "instalar", "intentar", "intercambiar", "interesar", "interpretar", "introducir", "investigar", "invitar", "ir", "jugar", "lanzar", "lavar", "leer", "levantar", "liderar", "lidiar", "limpiar", "llamar", "llegar", "llenar", "llevar", "lograr", "manejar", "manipular", "mantener", "marcar", "medir", "mejorar", "mencionar", "meter", "mirar", "modificar", "monitorear", "montar", "mostrar", "motivar", "mover", "mutar", "nacer", "necesitar", "negociar", "nombrar", "notar", "obtener", "ocurrir", "ofrecer", "oír", "olvidar", "operar", "optimizar", "ordenar", "organizar", "pagar", "parar", "parecer", "participar", "pasar", "pedir", "pensar", "perder", "perfeccionar", "permitir", "pertenecer", "planear", "planificar", "plantear", "poder", "preparar", "presentar", "prestar", "proceder", "procesar", "producir", "programar", "promocionar", "promover", "proponer", "proporcionar", "proteger", "probar", "publicar", "publicitar", "pulir", "quedar", "querer", "quitar", "reabastecer", "realizar", "recibir", "recoger", "recomendar", "reconocer", "recordar", "recortar", "recuperar", "reducir", "reemplazar", "reestructurar", "registrar", "relacionar", "remunerar", "reparar", "repartir", "repetir", "reportar", "representar", "requerir", "reservar", "resolver", "responder", "restaurar", "resultar", "retirar", "reunir", "revisar", "saber", "sacar", "salir", "saltar", "saludar", "satisfacer", "seguir", "seleccionar", "sentar", "sentir", "señalar", "ser", "servir", "simular", "situar", "solicitar", "solucionar", "someter", "subir", "suceder", "sugerir", "superar", "supervisar", "suponer", "surgir", "surtir", "suspender", "terminar", "tocar", "tomar", "trabajar", "traducir", "traer", "transferir", "transformar", "transportar", "tratar", "unir", "usar", "utilizar", "validar", "valorar", "vender", "venir", "ver", "verificar", "viajar", "vigilar", "visitar", "vivir", "volver"]
        };
        const VAGUE_WORDS = ["maximizar", "minimizar", "sinergia", "proactivo", "apoyar", "dinamizar", "considerar", "tratar de", "buscar"];
        const STOP_WORDS = ["", "un", "una", "unos", "unas", "el", "la", "los", "las", "de", "del", "a", "al", "en", "para", "por", "con", "sin", "sobre", "y", "o", "pero", "como", "más", "su", "sus", "que", "es", "son", "ser", "estar", "tener", "hacer", "se", "nos", "le", "les", "mi", "mis", "tu", "tus", "este", "esta", "estos", "estas", "ese", "esa", "esos", "esas", "aquel", "aquella", "aquellos", "aquellas", "lo", "qué", "quién", "dónde", "cuándo", "cómo", "porque", "ya", "muy", "mucho", "poco", "desde", "hasta", "durante", "mediante", "través", "mismo", "misma", "mismos", "mismas"];
        const FORBIDDEN_PHRASES = [" para ", " con el fin de ", " a fin de ", " con el objetivo de ", " con la finalidad de ", " con el propósito de "];
        const CITATION_TEXT = "Montoya, Julio Cesar (2025) App ALINEA - Herramienta para la Formulación y Alineación Estratégica. Grupo de investigación ILAMA. Universidad Nacional Abierta y a Distancia. Palmira - Colombia. App desarrollada con asistencia de Gemini IA, Google AI Studio, entre otras.";

        // --- Contenido Estático (Tutorial COMPLETO) ---
        const TUTORIAL_HTML_CONTENT = `
        <h3>Tutorial de Uso Práctico ALINEA</h3>
        <p>Bienvenido/a a <strong>ALINEA</strong>, una herramienta diseñada como recurso pedagógico para apoyar la formulación y el análisis de la alineación estratégica.</p>
        <h4>Naturaleza y Enfoque</h4>
        <p>ALINEA te guía en la estructuración de los componentes clave de un plan estratégico, desde la Misión y Visión hasta las Actividades concretas. Es importante entender que esta herramienta funciona mediante la aplicación de <strong>reglas predefinidas</strong> basadas en buenas prácticas de planeación estratégica. <strong>No utiliza inteligencia artificial avanzada</strong> para interpretar el significado profundo o el contexto específico de tu organización.</p>
        <p>El proceso de uso está pensado para ser <strong>iterativo</strong>. Rara vez un plan estratégico queda perfecto al primer intento. La idea es que ingreses tu información inicial, analices el feedback proporcionado por la herramienta, reflexiones, ajustes tus entradas y vuelvas a analizar, repitiendo este ciclo hasta conseguir un resultado coherente y plausible.</p>
        <h4>Pasos para Utilizar ALINEA:</h4>
        <ol style="list-style: decimal; margin-left: 1.5rem; margin-bottom: 0.75rem;">
            <li style="margin-bottom: 0.5rem;"><strong>Información General:</strong> Comienza ingresando el Nombre de la Organización, los Principios/Valores fundamentals y las Políticas generales que guían a tu entidad. Usa los tooltips (al pasar el cursor sobre las etiquetas con línea punteada) para obtener más detalles sobre cada campo.</li>
            <li style="margin-bottom: 0.5rem;"><strong>Misión y Visión:</strong> Define claramente la razón de ser actual (Misión) y la aspiración futura (Visión) de la organización.</li>
            <li style="margin-bottom: 0.5rem;"><strong>Alineación Estratégica (Dinámica):</strong>
                <ul>
                    <li>Usa el botón <strong>"+ Añadir Objetivo Estratégico"</strong> para crear los objetivos principales.</li>
                    <li>Dentro de cada objetivo, usa <strong>"+ Añadir Estrategia"</strong> para definir los enfoques.</li>
                    <li>Dentro de cada estrategia, usa <strong>"+ Añadir Táctica"</strong> para las acciones concretas.</li>
                    <li>Dentro de cada táctica, usa <strong>"+ Añadir Actividad"</strong> para las tareas específicas.</li>
                    <li>Puedes añadir tantos elementos como necesites en cada nivel.</li>
                    <li>Usa los botones <i data-lucide="trash-2" style="width:0.9em; height:0.9em; vertical-align: -0.1em; color: #dc2626;"></i> para eliminar elementos que no necesites (esto eliminará también los elementos hijos).</li>
                    <li>Utiliza los botones <i data-lucide="list" style="width:0.9em; height:0.9em; vertical-align: -0.1em;"></i> junto a cada etiqueta para ver listas de verbos en infinitivo sugeridos.</li>
                    <li>Opcionalmente, completa los campos "KPI Principal" y "Responsable" para los Objetivos Estratégicos y las Actividades.</li>
                </ul>
             </li>
            <li style="margin-bottom: 0.5rem;"><strong>Analizar:</strong> Una vez hayas ingresado la información, haz clic en el botón <strong class="text-blue-700">"Analizar Plan Estratégico"</strong>.</li>
            <li style="margin-bottom: 0.5rem;"><strong>Revisar Resultados:</strong><ul><li><strong>Análisis y Sugerencias:</strong> Lee detenidamente el feedback en esta área. Presta atención a los iconos: ⚠️ (Puntos críticos/Advertencias), 💡 (Sugerencias de mejora). Los campos del formulario que tengan observaciones se resaltarán en rojo (⚠️) o amarillo (💡). Los campos que cumplan bien criterios clave (ej. verbo inicial, SMART) se resaltarán en verde (✅).</li><li><strong>Plan Formulado:</strong> Revisa cómo se estructura tu plan completo en esta sección.</li></ul></li>
            <li style="margin-bottom: 0.5rem;"><strong>Iterar y Refinar:</strong> Utiliza el feedback recibido para ajustar y mejorar tus entradas en el formulario. Vuelve a hacer clic en "Analizar Plan Estratégico" para ver los nuevos resultados. Repite este proceso hasta que el plan te parezca sólido y coherente.</li></ol>
        <h4>Responsabilidad del Usuario</h4>
        <p>Recuerda que ALINEA es una <strong>herramienta de apoyo y aprendizaje</strong>. Sus sugerencias se basan en reglas sobre estructura, formato y uso de palabras clave. No puede comprender la complejidad, matices o el contexto único de tu organización.</p>
        <p><strong>La responsabilidad final de validar, curar y asegurar la calidad estratégica del plan recae en ti, el usuario.</strong> Debes aplicar tu criterio profesional, tu conocimiento de los conceptos estratégicos (aunque la App se construyó rigurosamente con estos criterios) y tu comprensión profunda de la realidad organizacional para interpretar los resultados y tomar las decisiones finales sobre el plan.</p>
        <p>¡Esperamos que ALINEA te sea de gran utilidad en tu proceso de planeación estratégica!</p>
        <div class="citation" style="text-align: left; padding-left: 0; margin-top: 1rem;">
        ${CITATION_TEXT}
        </div>`;

        // --- Contenido Conceptual (MODIFICADO: Comentario eliminado) ---
        const CONCEPTUAL_HTML_CONTENT = `
        <h3>Componentes Conceptuales y Diccionario de Verbos</h3>

        <h4>Componentes Fundamentales</h4>
        <p><strong>Misión:</strong> Es la razón de ser fundamental de la organización en el presente. Describe qué hace, para quién lo hace y qué la diferencia. Debe ser clara, concisa e inspiradora, reflejando el propósito actual.</p>
        <p><strong>Visión:</strong> Es la declaración de la aspiración futura de la organización. Describe a dónde quiere llegar a largo plazo (usualmente 3-5 años o más) y cómo se ve a sí misma en ese futuro deseado. Debe ser ambiciosa pero alcanzable.</p>
        <p><strong>Principios / Valores:</strong> Son las creencias y convicciones fundamentals que guían el comportamiento y la toma de decisiones en la organización. Son atemporales y forman la base de la cultura organizacional. No deben iniciar con verbos de acción.</p>
        <p><strong>Políticas:</strong> Son directrices o reglas generales que orientan la toma de decisiones y la acción en situaciones recurrentes, asegurando consistencia y alineación con los objetivos y valores. Definen límites y marcos de actuación.</p>

        <h4>Jerarquía de la Planeación Estratégica (O-E-T-A)</h4>
        <p>La planeación estratégica se despliega en una jerarquía donde cada nivel se vuelve más específico y operativo, asegurando que las acciones diarias contribuyan a la visión a largo plazo:</p>
        <ul style="list-style: disc; margin-left: 1.5rem;">
            <li><strong>Objetivo Estratégico:</strong> Define QUÉ se quiere lograr a largo plazo para alcanzar la Visión. Son metas amplias, medibles (SMART) y con un horizonte temporal definido.</li>
            <li><strong>Estrategia:</strong> Describe el CÓMO general o el enfoque principal que se adoptará para alcanzar un Objetivo Estratégico específico.</li>
            <li><strong>Táctica:</strong> Detalla las acciones más específicas y a corto/mediano plazo que se implementarán para llevar a cabo una Estrategia.</li>
            <li><strong>Actividad:</strong> Son las tareas concretas y operativas del día a día, medibles y con plazos definidos, necesarias para ejecutar una Táctica.</li>
            <li><strong>KPI Principal (Opcional - Obj/Act):</strong> Indicador Clave de Desempeño que permite medir el progreso hacia el objetivo o la finalización de la actividad.</li>
            <li><strong>Responsable (Opcional - Obj/Act):</strong> Persona, rol o área encargada de liderar o ejecutar el objetivo o la actividad.</li>
        </ul>

        <h4>Estructura Sugerida para Objetivos y Actividades (Guía Informativa)</h4>
        <p>Para lograr claridad y asegurar que los Objetivos Estratégicos y las Actividades sean medibles y tengan plazo (criterios SMART), se sugiere la siguiente estructura básica (esto <em>no</em> es una regla de validación estricta de la App, sino una recomendación conceptual):</p>
        <p><code>Verbo en infinitivo</code> + <code>Objeto (qué se afecta)</code> + <code>Cantidad y Unidad de Medida</code> + <code>Término (Plazo)</code> + <code>Condición, Restricción o Medio (opcional)</code></p>
        <p><em>Ejemplo:</em> <code>Incrementar</code> (verbo) <code>la cuota de mercado</code> (objeto) <code>en un 5%</code> (medida) <code>para el cierre del año fiscal 2026</code> (plazo) <code>en el segmento de PYMES</code> (condición).</p>

        <h4>Coherencia Vertical (Guía Informativa)</h4>
        <p>La alineación entre los niveles jerárquicos (Objetivo → Estrategia → Táctica → Actividad) es crucial. Esta coherencia vertical generalmente se manifiesta de dos formas:</p>
        <ol style="list-style: decimal; margin-left: 1.5rem;">
            <li><strong>Subordinación Conceptual del Verbo:</strong> El verbo de un nivel inferior suele representar una acción que contribuye o detalla la acción del nivel superior. Por ejemplo, si el Objetivo es <code>Incrementar</code>, la Estrategia podría ser <code>Implementar</code> (un nuevo sistema), la Táctica <code>Desarrollar</code> (el sistema) y la Actividad <code>Programar</code> (un módulo específico).</li>
            <li><strong>Conexión por el Objeto:</strong> El objeto o tema sobre el que recae la acción suele mantenerse o especificarse a medida que se desciende en la jerarquía. Si el Objetivo habla de "satisfacción del cliente", la Estrategia, Táctica y Actividades deberían relacionarse con aspectos concretos de esa satisfacción (tiempos de respuesta, calidad del producto, etc.). ALINEA utiliza la presencia de palabras clave comunes como un indicador de esta conexión léxica.</li>
        </ol>

        <h4>Nota sobre Cláusulas de Propósito ("para", "con el fin de...")</h4>
        <p>Se desaconseja el uso de cláusulas de propósito (como 'para', 'con el fin de', 'con el propósito de') en la redacción de objetivos, estrategias, etc. Aunque comunes, pueden generar ambigüedad al introducir múltiples verbos infinitivos, tendiendo a confundir el <strong>medio</strong> (la acción secundaria o vía) con el <strong>fin</strong> (la acción principal que se persigue).</p>
        <p>Este tipo de redacción puede desviar la atención de la acción principal que se desea lograr, debilitando la claridad y fuerza del componente estratégico. En lugar de estructurar la frase separando el medio del fin mediante una cláusula de propósito, se recomienda destacar el <strong>propósito más elevado (el fin) desde el inicio con el verbo principal</strong>, y ubicar el <strong>medio como un complemento o vía de acción</strong> (usando expresiones como 'mediante', 'a través de', 'por medio de'). De esta manera, la jerarquía de ideas es clara y el foco permanece en el resultado principal.</p>
        <p><strong>Ejemplo Comparativo:</strong></p>
        <blockquote>
            <p><em>Menos recomendable (con cláusula de propósito, mezcla medio y fin):</em><br>
            “Desarrollar competencias en la gestión sostenible del patrimonio natural y cultural <strong>con el propósito de fomentar</strong> prácticas responsables y la participación de la comunidad local en el turismo.”</p>
            <p><em>Redacción más clara (centrada en el fin, medio como complemento):</em><br>
            “Desarrollar competencias en la gestión sostenible del patrimonio natural y cultural en los estudiantes, <strong>por medio del fomento</strong> de prácticas responsables y de la participación activa de la comunidad local en el turismo sostenible, durante el periodo académico 2025-1.”</p>
        </blockquote>
        <p>ALINEA te advertirá (⚠️) si detecta estas frases para que consideres reformular, enfocándote en un único verbo principal claro al inicio.</p>

        <h4>Nota sobre Verbos Sugeridos y Potencial Ambigüedad</h4>
        <p>Algunos verbos incluidos en las listas sugeridas, aunque comunes y a veces necesarios en el lenguaje estratégico (ej: <code>analizar</code>, <code>facilitar</code>, <code>gestionar</code>, <code>evaluar</code>, <code>impulsar</code>, <code>asegurar</code>), pueden ser inherentemente menos específicos que otros. Su significado puede ser amplio y dificultar la medición clara del progreso.</p>
        <p>ALINEA también identifica un conjunto más reducido de palabras (<code>maximizar</code>, <code>minimizar</code>, <code>apoyar</code>, <code>buscar</code>, etc. - ver lista <code>VAGUE_WORDS</code> en el código) que casi siempre requieren mayor concreción y generará una sugerencia (💡) específica para ellas.</p>
        <p><strong>¿Por qué buscar mayor especificidad?</strong></p>
        <ul class="example-list">
             <li>"<strong>Maximizar</strong> las ventas" <span class="example-explanation">(Versión vaga: falta métrica y plazo)</span> vs. "<strong>Incrementar</strong> las ventas en un 15% para Q4" <span class="example-explanation">(Versión específica)</span>.</li>
             <li>"<strong>Apoyar</strong> al equipo de marketing" <span class="example-explanation">(Versión vaga: acción poco definida)</span> vs. "<strong>Asignar</strong> un presupuesto adicional de X..." o "<strong>Capacitar</strong> al equipo en herramientas Y..." <span class="example-explanation">(Versiones específicas)</span>.</li>
             <li>"<strong>Analizar</strong> la competencia" <span class="example-explanation">(Versión vaga: falta resultado esperado y plazo)</span> vs. "<strong>Identificar</strong> las 3 principales debilidades de la competencia Z antes de fin de mes" <span class="example-explanation">(Versión específica)</span>.</li>
             <li>"<strong>Garantizar</strong> la satisfacción" <span class="example-explanation">(Versión vaga: difícil de medir/asegurar)</span> vs. "<strong>Implementar</strong> un sistema NPS y alcanzar 50 puntos este semestre" <span class="example-explanation">(Versión específica y medible)</span>.</li>
        </ul>
        <p>La recomendación general es siempre complementar el verbo elegido (especialmente si es amplio) con <strong>detalles concretos, métricas y plazos</strong> (requisitos SMART para Objetivos y Actividades) para asegurar la claridad y la capacidad de seguimiento del plan.</p>

        <h4>Diccionario de Verbos Sugeridos por Nivel Jerárquico</h4>
        <p>A continuación se presentan los verbos sugeridos para cada nivel, junto con definiciones adaptadas al contexto de la planeación estratégica:</p>
         <h5>Nivel: Objetivo Estratégico</h5> <p><em>Propósito conceptual: Definir, proyectar...</em></p> <ul style="list-style: none; padding-left: 0;"> <li><strong>afianzar:</strong> Hacer más firme o seguro...</li><li><strong>alcanzar:</strong> Llegar a un punto o nivel determinado...</li><li><strong>alinear:</strong> Poner en línea o coordinar diferentes elementos...</li><li><strong>analizar:</strong> Examinar detalladamente una situación...</li><li><strong>articular:</strong> Unir o enlazar diferentes partes...</li><li><strong>asegurar:</strong> Establecer o garantizar que algo se cumpla...</li><li><strong>concebir:</strong> Formar o crear mentalmente la idea...</li><li><strong>consolidar:</strong> Dar firmeza y solidez a algo...</li><li><strong>definir:</strong> Establecer con claridad y precisión los elementos...</li><li><strong>determinar:</strong> Fijar o establecer con precisión cuáles serán los objetivos...</li><li><strong>diagnosticar:</strong> Analizar la situación actual...</li><li><strong>discutir:</strong> Examinar o debatir las diferentes opciones...</li><li><strong>diversificar:</strong> Ampliar la variedad de productos...</li><li><strong>establecer:</strong> Fijar o instituir las metas y la orientación general...</li><li><strong>estimar:</strong> Calcular o determinar el valor aproximado...</li><li><strong>expandir:</strong> Aumentar el tamaño, alcance o presencia...</li><li><strong>facilitar:</strong> Proporcionar medios o hacer más fácil...</li><li><strong>fijar:</strong> Determinar o establecer de forma precisa...</li><li><strong>formar:</strong> Crear o constituir algo...</li><li><strong>formular:</strong> Idear y expresar de manera clara y concisa...</li><li><strong>fortalecer:</strong> Hacer más fuerte o sólido...</li><li><strong>garantizar:</strong> Asegurar o dar certeza sobre el cumplimiento...</li><li><strong>generar:</strong> Producir o crear...</li><li><strong>idear:</strong> Concebir o crear una idea o plan.</li><li><strong>identificar:</strong> Reconocer y definir cuáles son los objetivos...</li><li><strong>impulsar:</strong> Estimular o promover el desarrollo...</li><li><strong>incrementar:</strong> Aumentar la cantidad, tamaño, intensidad...</li><li><strong>innovar:</strong> Introducir nuevas ideas, métodos o soluciones...</li><li><strong>integrar:</strong> Unir o combinar diferentes partes...</li><li><strong>internacionalizar:</strong> Extender las operaciones o presencia...</li><li><strong>introducir:</strong> Incorporar o presentar nuevos elementos...</li><li><strong>liderar:</strong> Dirigir o estar a la cabeza...</li><li><strong>lograr:</strong> Conseguir o alcanzar lo que se intenta...</li><li><strong>modificar:</strong> Cambiar o transformar algo.</li><li><strong>optimizar:</strong> Buscar la mejor manera de realizar...</li><li><strong>plantear:</strong> Proponer o exponer los objetivos...</li><li><strong>posicionar:</strong> Situar la marca, producto o servicio...</li><li><strong>potenciar:</strong> Aumentar la fuerza, capacidad o efecto...</li><li><strong>presentar:</strong> Mostrar o dar a conocer formalmente...</li><li><strong>priorizar:</strong> Determinar el orden de importancia...</li><li><strong>promover:</strong> Fomentar o impulsar el desarrollo...</li><li><strong>proponer:</strong> Plantear o sugerir una idea, plan u objetivo.</li><li><strong>proporcionar:</strong> Facilitar o suministrar la base y la dirección...</li><li><strong>proyectar:</strong> Estimar o prever el estado futuro...</li><li><strong>reafirmar:</strong> Volver a confirmar o asegurar...</li><li><strong>reconocer:</strong> Identificar o distinguir...</li><li><strong>redefinir:</strong> Volver a definir o establecer los límites...</li><li><strong>reducir:</strong> Disminuir o aminorar...</li><li><strong>reformular:</strong> Modificar o cambiar la definición...</li><li><strong>reestructurar:</strong> Modificar la estructura fundamental...</li><li><strong>transformar:</strong> Cambiar profoundly la forma...</li><li><strong>desarrollar:</strong> Hacer crecer o progresar algo...</li> </ul>
         <h5>Nivel: Estrategia</h5> <p><em>Propósito conceptual: Diseñar el plan general...</em></p> <ul style="list-style: none; padding-left: 0;"> <li><strong>adaptar:</strong> Ajustar o modificar las estrategias...</li><li><strong>afrontar:</strong> Hacer frente a un problema...</li><li><strong>ajustar:</strong> Adaptar o acomodar algo...</li><li><strong>analizar:</strong> Examinar detalladamente componentes...</li><li><strong>asignar:</strong> Distribuir o designar los recursos...</li><li><strong>automatizar:</strong> Implementar sistemas automáticos...</li><li><strong>cambiar:</strong> Modificar o transformar aspectos...</li><li><strong>coordinar:</strong> Organizar y armonizar acciones...</li><li><strong>comparar:</strong> Establecer similitudes o diferencias...</li><li><strong>configurar:</strong> Dar una forma o estructura...</li><li><strong>confrontar:</strong> Afrontar o resolver los desafíos...</li><li><strong>delegar:</strong> Asignar responsabilidades y autoridad...</li><li><strong>definir:</strong> Establecer claramente el alcance...</li><li><strong>desarrollar:</strong> Elaborar o crear los planes...</li><li><strong>deshacer:</strong> Eliminar o revertir estructuras...</li><li><strong>desplegar:</strong> Distribuir y utilizar los recursos...</li><li><strong>digitalizar:</strong> Convertir procesos o información clave...</li><li><strong>dirigir:</strong> Guiar y orientar la ejecución...</li><li><strong>diseñar:</strong> Crear o concebir la estructura...</li><li><strong>distribuir:</strong> Repartir recursos, responsabilidades...</li><li><strong>diversificar:</strong> Aplicar una estrategia de ampliación...</li><li><strong>ejecutar:</strong> Realizar o llevar a cabo las estrategias...</li><li><strong>encaminar:</strong> Dirigir o guiar las acciones...</li><li><strong>enfocar:</strong> Centrar la atención y los recursos...</li><li><strong>establecer:</strong> Fijar o instituir los marcos...</li><li><strong>estimar:</strong> Calcular los recursos, tiempos...</li><li><strong>estimular:</strong> Fomentar o incentivar acciones...</li><li><strong>evaluar:</strong> Analizar y juzgar la efectividad...</li><li><strong>examinar:</strong> Investigar o analizar en detalle...</li><li><strong>expandir:</strong> Aplicar una estrategia de crecimiento...</li><li><strong>facilitar:</strong> Hacer posible o proporcionar los medios...</li><li><strong>fomentar:</strong> Promover o impulsar...</li><li><strong>formular:</strong> Expresar y definir formalmente...</li><li><strong>hacer:</strong> Realizar o llevar a cabo acciones...</li><li><strong>identificar:</strong> Reconocer y seleccionar los enfoques...</li><li><strong>implementar:</strong> Poner en práctica o llevar a cabo las acciones...</li><li><strong>integrar:</strong> Combinar diferentes iniciativas...</li><li><strong>investigar:</strong> Realizar estudios o indagaciones...</li><li><strong>mejorar:</strong> Optimizar o hacer más eficiente...</li><li><strong>modificar:</strong> Cambiar o ajustar la estrategia...</li><li><strong>monitorear:</strong> Realizar un seguimiento continuo...</li><li><strong>mover:</strong> Desplazar recursos o esfuerzos...</li><li><strong>operacionalizar:</strong> Traducir las estrategias generales...</li><li><strong>optimizar:</strong> Mejorar la eficiencia y efectividad...</li><li><strong>organizar:</strong> Estructurar los recursos y equipos...</li><li><strong>otorgar:</strong> Conceder o asignar recursos...</li><li><strong>penetrar:</strong> Aplicar una estrategia para introducirse...</li><li><strong>planear:</strong> Diseñar el plan general...</li><li><strong>priorizar:</strong> Ordenar las iniciativas estratégicas...</li><li><strong>proponer:</strong> Sugerir o plantear una estrategia...</li><li><strong>proporcionar:</strong> Suministrar los recursos o el marco...</li><li><strong>proyectar:</strong> Planificar o prever el desarrollo...</li><li><strong>realizar:</strong> Llevar a cabo análisis o estudios...</li><li><strong>recompensar:</strong> Otorgar reconocimiento o compensación...</li><li><strong>reorganizar:</strong> Modificar la estructura o la distribución...</li><li><strong>retroalimentar:</strong> Proporcionar información sobre el desempeño...</li><li><strong>romper:</strong> Deshacer o superar barreras...</li><li><strong>seleccionar:</strong> Elegir el enfoque estratégico...</li><li><strong>supervisar:</strong> Vigilar y controlar la ejecución...</li><li><strong>traducir:</strong> Convertir los objetivos estratégicos...</li><li><strong>transferir:</strong> Mover o desplazar recursos...</li><li><strong>transformar:</strong> Aplicar una estrategia de cambio...</li><li><strong>vigilar:</strong> Observar atentamente el entorno...</li> </ul>
         <h5>Nivel: Táctica</h5> <p><em>Propósito conceptual: Desarrollar planes más detallados...</em></p> <ul style="list-style: none; padding-left: 0;"> <li><strong>activar:</strong> Poner en funcionamiento o iniciar...</li><li><strong>adaptar:</strong> Ajustar planes tácticos...</li><li><strong>adquirir:</strong> Obtener recursos específicos...</li><li><strong>administrar:</strong> Gestionar los recursos y el presupuesto...</li><li><strong>alinear:</strong> Asegurar que las acciones tácticas...</li><li><strong>analizar:</strong> Examinar datos o resultados...</li><li><strong>articular:</strong> Coordinar y enlazar diferentes actividades...</li><li><strong>asignar:</strong> Distribuir los recursos específicos...</li><li><strong>asegurar:</strong> Garantizar que se cumplan los pasos...</li><li><strong>capacitar:</strong> Entrenar al personal necesario...</li><li><strong>comunicar:</strong> Informar y transmitir las directrices...</li><li><strong>consolidar:</strong> Unificar esfuerzos o resultados...</li><li><strong>construir:</strong> Crear entregables o herramientas...</li><li><strong>contratar:</strong> Incorporar personal o servicios...</li><li><strong>controlar:</strong> Supervisar y evaluar el progreso...</li><li><strong>coordinar:</strong> Sincronizar las actividades...</li><li><strong>crear:</strong> Generar materiales, campañas...</li><li><strong>definir:</strong> Establecer con mayor detalle las acciones...</li><li><strong>desarrollar:</strong> Elaborar o crear planes y acciones...</li><li><strong>distribuir:</strong> Repartir tareas o materiales...</li><li><strong>ejecutar:</strong> Llevar a cabo las acciones y los planes...</li><li><strong>elaborar:</strong> Preparar documentos, informes...</li><li><strong>establecer:</strong> Fijar procedimientos, canales...</li><li><strong>estandardizar:</strong> Definir y aplicar normas comunes...</li><li><strong>estructurar:</strong> Organizar los componentes...</li><li><strong>evaluar:</strong> Analizar los resultados...</li><li><strong>gestionar:</strong> Administrar los recursos y los procesos...</li><li><strong>implementar:</strong> Poner en práctica las acciones...</li><li><strong>informar:</strong> Comunicar el estado o los resultados...</li><li><strong>integrar:</strong> Combinar diferentes herramientas...</li><li><strong>lanzar:</strong> Iniciar una nueva campaña...</li><li><strong>modificar:</strong> Ajustar o cambiar elementos...</li><li><strong>monitorear:</strong> Hacer seguimiento continuo...</li><li><strong>negociar:</strong> Llegar a acuerdos con proveedores...</li><li><strong>optimizar:</strong> Mejorar la eficiencia o efectividad...</li><li><strong>organizar:</strong> Estructurar y coordinar los recursos...</li><li><strong>planificar:</strong> Elaborar planes detallados...</li><li><strong>priorizar:</strong> Ordenar las acciones tácticas...</li><li><strong>programar:</strong> Calendarizar y asignar tiempos...</li><li><strong>publicar:</strong> Difundir información o contenidos...</li><li><strong>realizar:</strong> Llevar a cabo estudios, pruebas...</li><li><strong>regular:</strong> Establecer normas o controles...</li><li><strong>reorganizar:</strong> Modificar la estructura o la distribución...</li><li><strong>revisar:</strong> Examinar y comprobar el estado...</li><li><strong>segmentar:</strong> Dividir un mercado o audiencia...</li><li><strong>sincronizar:</strong> Coordinar acciones tácticas...</li><li><strong>sistematizar:</strong> Establecer un método o sistema...</li><li><strong>supervisar:</strong> Vigilar y dirigir la correcta ejecución...</li> </ul>
         <h5>Nivel: Actividad</h5> <p><em>Propósito conceptual: Ejecutar las tareas operativas...</em></p> <ul style="list-style: none; padding-left: 0;"> <li><strong>abastecer:</strong> Volver a proveer o surtir...</li><li><strong>aceptar:</strong> Recibir o dar consentimiento...</li><li><strong>admitir:</strong> Aceptar o incorporar personas...</li><li><strong>adquirir:</strong> Obtener los recursos, materiales...</li><li><strong>agendar:</strong> Programar o fijar una fecha/hora...</li><li><strong>ajustar:</strong> Modificar ligeramente parámetros...</li><li><strong>almacenar:</strong> Guardar o depositar materiales...</li><li><strong>analizar:</strong> Examinar datos específicos...</li><li><strong>animar:</strong> Motivar o impulsar a realizar...</li><li><strong>aplicar:</strong> Poner en práctica técnicas...</li><li><strong>archivar:</strong> Guardar documentos o información...</li><li><strong>arreglar:</strong> Reparar o solucionar un problema...</li><li><strong>asignar:</strong> Distribuir tareas, responsabilidades...</li><li><strong>asistir:</strong> Prestar ayuda o soporte...</li><li><strong>atender:</strong> Prestar servicio, ayuda o resolver...</li><li><strong>aumentar:</strong> Incrementar un variable o categoría...</li><li><strong>automatizar:</strong> Convertir una actividad manual...</li><li><strong>brindar:</strong> Ofrecer o proporcionar asistencia...</li><li><strong>calcular:</strong> Realizar operaciones matemáticas...</li><li><strong>cambiar:</strong> Sustituir o modificar un elemento...</li><li><strong>capacitar:</strong> Formar en nuevas capacidades...</li><li><strong>cargar:</strong> Introducir datos o materiales...</li><li><strong>cerrar:</strong> Concluir o finalizar una tarea...</li><li><strong>clasificar:</strong> Ordenar o categorizar elementos...</li><li><strong>cobrar:</strong> Realizar la gestión de pago...</li><li><strong>codificar:</strong> Asignar un código a información...</li><li><strong>colocar:</strong> Poner algo en un lugar determinado.</li><li><strong>comercializar:</strong> Realizar las actividades necesarias...</li><li><strong>comprar:</strong> Adquirir los insumos, materiales...</li><li><strong>comunicar:</strong> Informar o transmitir información...</li><li><strong>concretar:</strong> Llevar a cabo o materializar...</li><li><strong>conducir:</strong> Guiar o dirigir las acciones...</li><li><strong>conseguir:</strong> Obtener o lograr algo necesario...</li><li><strong>conservar:</strong> Mantener algo en buen estado.</li><li><strong>contar:</strong> Enumerar o llevar un registro numérico...</li><li><strong>contactar:</strong> Establecer comunicación con alguien.</li><li><strong>contratar:</strong> Formalizar la adquisición...</li><li><strong>controlar:</strong> Supervisar la calidad, los tiempos...</li><li><strong>convertir:</strong> Transformar datos o materiales...</li><li><strong>coordinar:</strong> Organizar y armonizar esfuerzos...</li><li><strong>corregir:</strong> Enmendar errores en una tarea...</li><li><strong>cotizar:</strong> Elaborar y presentar una oferta...</li><li><strong>crear:</strong> Generar un documento, registro...</li><li><strong>cumplir:</strong> Llevar a cabo o satisfacer los requerimientos...</li><li><strong>dar:</strong> Proporcionar o entregar algo...</li><li><strong>decidir:</strong> Tomar una determinación...</li><li><strong>definir:</strong> Establecer los parámetros o pasos...</li><li><strong>dejar:</strong> Poner o situar algo en un lugar.</li><li><strong>demostrar:</strong> Probar o evidenciar el funcionamiento...</li><li><strong>describir:</strong> Explicar cómo es o cómo funciona...</li><li><strong>desarrollar:</strong> Elaborar o crear programas y técnicas...</li><li><strong>descargar:</strong> Bajar información o archivos...</li><li><strong>deshacer:</strong> Revertir una acción o eliminar...</li><li><strong>designar:</strong> Nombrar a alguien para una tarea...</li><li><strong>detallar:</strong> Especificar o describir con precisión...</li><li><strong>determinar:</strong> Establecer o fijar un valor...</li><li><strong>devolver:</strong> Restituir algo a su estado...</li><li><strong>difundir:</strong> Extender o comunicar información...</li><li><strong>dirigir:</strong> Guiar la ejecución de una tarea...</li><li><strong>diseñar:</strong> Crear o planificar a nivel detallado...</li><li><strong>disminuir:</strong> Reducir la cantidad o intensidad...</li><li><strong>disponer:</strong> Preparar o colocar algo para un fin.</li><li><strong>distribuir:</strong> Repartir materiales, productos...</li><li><strong>dividir:</strong> Separar algo en partes.</li><li><strong>documentar:</strong> Registrar información sobre una tarea...</li><li><strong>dotar:</strong> Proveer de lo necesario para una tarea.</li><li><strong>editar:</strong> Modificar o corregir un texto...</li><li><strong>ejecutar:</strong> Llevar a la práctica las acciones...</li><li><strong>elaborar:</strong> Crear o producir documentos...</li><li><strong>elegir:</strong> Seleccionar una opción entre varias.</li><li><strong>emitir:</strong> Producir y enviar un documento...</li><li><strong>empacar:</strong> Preparar productos o materiales...</li><li><strong>empezar:</strong> Iniciar una tarea o actividad.</li><li><strong>encontrar:</strong> Localizar algo o a alguien.</li><li><strong>enfrentar:</strong> Abordar una dificultad...</li><li><strong>entender:</strong> Comprender instrucciones...</li><li><strong>entrar:</strong> Ingresar datos o acceder...</li><li><strong>entregar:</strong> Proporcionar o facilitar la llegada...</li><li><strong>entrenar:</strong> Capacitar al personal en la ejecución...</li><li><strong>enviar:</strong> Expedir o hacer llegar información...</li><li><strong>equipar:</strong> Dotar o proveer de los recursos...</li><li><strong>escribir:</strong> Redactar textos o registrar...</li><li><strong>escuchar:</strong> Prestar atención a lo que se oye...</li><li><strong>esperar:</strong> Aguardar a que algo suceda...</li><li><strong>establecer:</strong> Fijar o determinar una condición...</li><li><strong>estimar:</strong> Calcular aproximadamente el tiempo...</li><li><strong>estudiar:</strong> Analizar o examinar información...</li><li><strong>evaluar:</strong> Valorar o determinar el rendimiento...</li><li><strong>evitar:</strong> Impedir que algo suceda.</li><li><strong>examinar:</strong> Revisar algo detalladamente.</li><li><strong>exigir:</strong> Requerir el cumplimiento...</li><li><strong>explicar:</strong> Hacer comprender algo...</li><li><strong>expedir:</strong> Enviar o remitir documentos...</li><li><strong>fabricar:</strong> Elaborar o construir productos...</li><li><strong>facturar:</strong> Emitir documentos de cobro...</li><li><strong>fijar:</strong> Establecer o determinar algo...</li><li><strong>firmar:</strong> Poner la firma en un documento.</li><li><strong>formar:</strong> Instruir o educar en una habilidad...</li><li><strong>funcionar:</strong> Operar o marchar correctamente...</li><li><strong>ganar:</strong> Obtener un beneficio...</li><li><strong>gastar:</strong> Emplear dinero o recursos.</li><li><strong>generar:</strong> Producir o causar algo...</li><li><strong>gestionar:</strong> Administrar o dirigir las operaciones...</li><li><strong>grabar:</strong> Registrar sonidos o imágenes...</li><li><strong>guardar:</strong> Conservar o almacenar algo.</li><li><strong>guiar:</strong> Orientar o dirigir a alguien...</li><li><strong>hablar:</strong> Comunicarse verbalmente.</li><li><strong>hacer:</strong> Realizar una tarea o acción...</li><li><strong>identificar:</strong> Reconocer o distinguir algo...</li><li><strong>implementar:</strong> Poner en práctica o llevar a cabo cambios...</li><li><strong>impulsar:</strong> Estimular o promover la realización...</li><li><strong>imprimir:</strong> Marcar texto o imágenes...</li><li><strong>incluir:</strong> Poner algo dentro de otra cosa...</li><li><strong>incrementar:</strong> Aumentar la cantidad o valor...</li><li><strong>indicar:</strong> Señalar o mostrar algo.</li><li><strong>informar:</strong> Dar noticia o comunicar algo.</li><li><strong>iniciar:</strong> Empezar una tarea o proceso.</li><li><strong>inscribir:</strong> Registrar a alguien o algo...</li><li><strong>inspeccionar:</strong> Examinar productos, procesos...</li><li><strong>instalar:</strong> Colocar o montar equipos...</li><li><strong>intentar:</strong> Tratar de hacer algo.</li><li><strong>intercambiar:</strong> Cambiar información o elementos...</li><li><strong>interesar:</strong> Despertar la atención...</li><li><strong>interpretar:</strong> Explicar o comprender el significado...</li><li><strong>introducir:</strong> Meter datos o elementos...</li><li><strong>investigar:</strong> Realizar indagaciones o estudios...</li><li><strong>invitar:</strong> Animar a alguien a participar...</li><li><strong>ir:</strong> Desplazarse a un lugar.</li><li><strong>jugar:</strong> Participar en un juego...</li><li><strong>lanzar:</strong> Iniciar la ejecución de un programa...</li><li><strong>lavar:</strong> Limpiar algo con agua...</li><li><strong>leer:</strong> Interpretar texto escrito.</li><li><strong>levantar:</strong> Mover algo hacia arriba; recoger...</li><li><strong>liderar:</strong> Dirigir o guiar a equipos...</li><li><strong>lidiar:</strong> Enfrentar o solucionar problemas...</li><li><strong>limpiar:</strong> Quitar la suciedad de algo.</li><li><strong>llamar:</strong> Comunicarse por teléfono...</li><li><strong>llegar:</strong> Alcanzar un destino...</li><li><strong>llenar:</strong> Ocupar un espacio vacío; completar...</li><li><strong>llevar:</strong> Transportar algo; realizar...</li><li><strong>lograr:</strong> Conseguir completar una tarea...</li><li><strong>manejar:</strong> Manipular o utilizar herramientas...</li><li><strong>manipular:</strong> Operar algo con las manos.</li><li><strong>mantener:</strong> Conservar o preservar equipos...</li><li><strong>marcar:</strong> Señalar o indicar algo.</li><li><strong>medir:</strong> Evaluar el desempeño...</li><li><strong>mejorar:</strong> Hacer que algo sea superior...</li><li><strong>mencionar:</strong> Nombrar o referirse a algo...</li><li><strong>meter:</strong> Introducir algo en un lugar.</li><li><strong>mirar:</strong> Dirigir la vista hacia algo.</li><li><strong>modificar:</strong> Cambiar detalles de una tarea...</li><li><strong>monitorear:</strong> Realizar un seguimiento continuo...</li><li><strong>montar:</strong> Ensamblar o instalar algo.</li><li><strong>mostrar:</strong> Exponer algo a la vista; enseñar.</li><li><strong>motivar:</strong> Animar o impulsar al personal...</li><li><strong>mover:</strong> Cambiar algo de lugar.</li><li><strong>mutar:</strong> Cambiar o transformar...</li><li><strong>nacer:</strong> Iniciar o surgir...</li><li><strong>necesitar:</strong> Requerir algo para una tarea.</li><li><strong>negociar:</strong> Llegar a acuerdos con otros...</li><li><strong>nombrar:</strong> Designar a alguien o algo.</li><li><strong>notar:</strong> Percibir o advertir algo.</li><li><strong>obtener:</strong> Conseguir o alcanzar determinados resultados...</li><li><strong>ocurrir:</strong> Suceder un evento...</li><li><strong>ofrecer:</strong> Presentar o dar algo...</li><li><strong>oír:</strong> Percibir sonidos.</li><li><strong>olvidar:</strong> No recordar algo.</li><li><strong>operar:</strong> Hacer funcionar o utilizar equipos...</li><li><strong>optimizar:</strong> Mejorar o perfeccionar la utilización...</li><li><strong>ordenar:</strong> Colocar cosas en su lugar; dar...</li><li><strong>organizar:</strong> Disponer y coordinar elementos...</li><li><strong>pagar:</strong> Entregar dinero a cambio...</li><li><strong>parar:</strong> Detener una actividad.</li><li><strong>parecer:</strong> Dar cierta impresión...</li><li><strong>participar:</strong> Tomar parte en una actividad.</li><li><strong>pasar:</strong> Moverse de un lugar a otro; entregar...</li><li><strong>pedir:</strong> Solicitar o requerir recursos...</li><li><strong>pensar:</strong> Considerar o reflexionar...</li><li><strong>perder:</strong> Dejar de tener algo; no encontrar.</li><li><strong>perfeccionar:</strong> Mejorar algo eliminando defectos.</li><li><strong>permitir:</strong> Dar autorización para hacer algo.</li><li><strong>pertenecer:</strong> Formar parte de un grupo...</li><li><strong>planear:</strong> Trazar el plan de una acción...</li><li><strong>planificar:</strong> Organizar y programar las acciones...</li><li><strong>plantear:</strong> Exponer un problema o duda...</li><li><strong>poder:</strong> Tener la capacidad de hacer algo.</li><li><strong>preparar:</strong> Disponer o acondicionar los elementos...</li><li><strong>presentar:</strong> Mostrar o dar a conocer algo...</li><li><strong>prestar:</strong> Ofrecer o facilitar un servicio...</li><li><strong>proceder:</strong> Actuar de una manera determinada...</li><li><strong>procesar:</strong> Llevar a cabo una serie de pasos...</li><li><strong>producir:</strong> Generar bienes, servicios...</li><li><strong>programar:</strong> Organizar y asignar tiempos...</li><li><strong>promocionar:</strong> Impulsar o fomentar el uso...</li><li><strong>promover:</strong> Iniciar o activar una acción...</li><li><strong>proponer:</strong> Sugerir una solución o idea...</li><li><strong>proporcionar:</strong> Entregar o facilitar algo...</li><li><strong>proteger:</strong> Resguardar algo de daño.</li><li><strong>probar:</strong> Verificar el funcionamiento...</li><li><strong>publicar:</strong> Hacer público un documento...</li><li><strong>publicitar:</strong> Dar a conocer o promocionar...</li><li><strong>pulir:</strong> Perfeccionar o mejorar detalles...</li><li><strong>quedar:</strong> Permanecer en un lugar o estado...</li><li><strong>querer:</strong> Desear o tener la intención...</li><li><strong>quitar:</strong> Remover algo de un lugar.</li><li><strong>reabastecer:</strong> Volver a proveer o surtir...</li><li><strong>realizar:</strong> Llevar a cabo o ejecutar las tareas...</li><li><strong>recibir:</strong> Aceptar o tomar posesión...</li><li><strong>recoger:</strong> Tomar o juntar algo.</li><li><strong>recomendar:</strong> Sugerir algo como bueno...</li><li><strong>reconocer:</strong> Identificar o admitir algo.</li><li><strong>recordar:</strong> Traer algo a la memoria.</li><li><strong>recortar:</strong> Reducir o quitar una parte.</li><li><strong>recuperar:</strong> Volver a obtener algo perdido...</li><li><strong>reducir:</strong> Disminuir elementos no deseados...</li><li><strong>reemplazar:</strong> Sustituir algo por otra cosa.</li><li><strong>reestructurar:</strong> Modificar o reorganizar los procesos...</li><li><strong>registrar:</strong> Documentar datos, información...</li><li><strong>relacionar:</strong> Establecer una conexión...</li><li><strong>remunerar:</strong> Pagar o compensar al personal...</li><li><strong>reparar:</strong> Arreglar o restaurar el funcionamiento...</li><li><strong>repartir:</strong> Distribuir algo entre varios.</li><li><strong>repetir:</strong> Realizar una tarea o actividad...</li><li><strong>reportar:</strong> Informar sobre el estado...</li><li><strong>representar:</strong> Ser imagen o símbolo...</li><li><strong>requerir:</strong> Necesitar o solicitar algo...</li><li><strong>reservar:</strong> Guardar algo para un uso...</li><li><strong>resolver:</strong> Solucionar problemas, fallas...</li><li><strong>responder:</strong> Contestar a una pregunta...</li><li><strong>restaurar:</strong> Devolver algo a su estado...</li><li><strong>resultar:</strong> Ser la consecuencia o efecto...</li><li><strong>retirar:</strong> Quitar o apartar algo.</li><li><strong>reunir:</strong> Juntar personas o cosas.</li><li><strong>revisar:</strong> Examinar o verificar la exactitud...</li><li><strong>saber:</strong> Tener conocimiento de algo.</li><li><strong>sacar:</strong> Extraer algo de un lugar.</li><li><strong>salir:</strong> Pasar de dentro afuera; partir.</li><li><strong>saltar:</strong> Omitir un paso o elemento.</li><li><strong>saludar:</strong> Dirigir palabras de cortesía.</li><li><strong>satisfacer:</strong> Cumplir con una necesidad...</li><li><strong>seguir:</strong> Realizar un seguimiento o supervisión...</li><li><strong>seleccionar:</strong> Elegir o escoger a las personas...</li><li><strong>sentar:</strong> Establecer o registrar...</li><li><strong>sentir:</strong> Experimentar una sensación...</li><li><strong>señalar:</strong> Indicar o marcar algo.</li><li><strong>ser:</strong> Existir; formar parte...</li><li><strong>servir:</strong> Ser útil para un fin; atender...</li><li><strong>simular:</strong> Crear modelos o representaciones...</li><li><strong>situar:</strong> Colocar algo en un lugar...</li><li><strong>solicitar:</strong> Pedir formalmente algo.</li><li><strong>solucionar:</strong> Encontrar una respuesta...</li><li><strong>someter:</strong> Presentar algo a la consideración...</li><li><strong>subir:</strong> Mover algo hacia arriba; cargar...</li><li><strong>suceder:</strong> Ocurrir un evento.</li><li><strong>sugerir:</strong> Proponer o insinuar una idea.</li><li><strong>superar:</strong> Vencer un obstáculo; exceder...</li><li><strong>supervisar:</strong> Vigilar y dirigir la ejecución...</li><li><strong>suponer:</strong> Considerar algo como cierto...</li><li><strong>surgir:</strong> Aparecer o manifestarse...</li><li><strong>surtir:</strong> Abastecer o proveer lo necesario...</li><li><strong>suspender:</strong> Detener temporalmente...</li><li><strong>terminar:</strong> Finalizar una tarea.</li><li><strong>tocar:</strong> Corresponder hacer algo; manipular.</li><li><strong>tomar:</strong> Coger algo; aceptar; registrar...</li><li><strong>trabajar:</strong> Realizar una actividad física...</li><li><strong>traducir:</strong> Convertir de un lenguaje...</li><li><strong>traer:</strong> Transportar algo al lugar...</li><li><strong>transferir:</strong> Pasar datos o elementos...</li><li><strong>transformar:</strong> Mutar de un estado a otro.</li><li><strong>transportar:</strong> Mover o trasladar materiales...</li><li><strong>tratar:</strong> Manejar un asunto; procesar...</li><li><strong>unir:</strong> Juntar o combinar elementos.</li>
            <li><strong>usar:</strong> Emplear algo para un fin.</li>
            <li><strong>utilizar:</strong> Hacer servir algo para un fin.</li>
            <li><strong>validar:</strong> Confirmar la exactitud o corrección de algo.</li>
            <li><strong>valorar:</strong> Determinar el valor o importancia de algo.</li>
            <li><strong>vender:</strong> Realizar la transacción de intercambio de un bien o servicio...</li>
            <li><strong>venir:</strong> Llegar o desplazarse hacia donde se habla.</li>
            <li><strong>ver:</strong> Percibir con la vista; revisar.</li>
            <li><strong>verificar:</strong> Comprobar la verdad o exactitud de algo.</li>
            <li><strong>viajar:</strong> Desplazarse a otro lugar.</li>
            <li><strong>vigilar:</strong> Observar atentamente para asegurar algo.</li>
            <li><strong>visitar:</strong> Ir a ver a alguien o un lugar.</li>
            <li><strong>vivir:</strong> Existir; experimentar una situación.</li>
            <li><strong>volver:</strong> Regresar a un lugar o estado anterior.</li>
        </ul>

        <h4>Referencias</h4>
        <p style="font-size: 0.8em; line-height: 1.4;">Cedeño-Pinoargote, J. A., Ramos, M., Facuy, J., González, J., & Portalanza, A. (2019). La Planeación Estratégica y la Creación de Valor en las Organizaciones. Universidad Espíritu Santo, Samborondón - Ecuador.</p>
        <p style="font-size: 0.8em; line-height: 1.4;">Chiavenato, I. (2017). PLANEACIÓN ESTRATÉGICA. FUNDAMENTOS Y APLICACIONES (3ra ed.; P. Obón, Trad.). MCGRAW-HILL INTERAMERICANA EDITORES, S.A.</p>
        <p style="font-size: 0.8em; line-height: 1.4;">Chiavenato, I. (S.f.). Administración. (Nota: No se dispone de información completa para esta referencia.)</p>
        <p style="font-size: 0.8em; line-height: 1.4;">Kaplan, R. S., & Norton, D. P. (2002). El Cuadro de Mando Integral: The Balanced Scorecard (2da ed.; A. Santapau, Trad.). Gestión 2000.</p>
        <p style="font-size: 0.8em; line-height: 1.4;">Krajewski, L. J., Ritzman, L. P., & Malhotra, M. K. (S.f.). Administración De Operaciones. Pearson Educación. (Nota: La fecha de publicación no se encuentra explícitamente.)</p>
        <p style="font-size: 0.8em; line-height: 1.4;">Porter, M. (S.f.). Administración Estratégica. (Nota: No se dispone de información completa para esta referencia.)</p>
        `;

        // --- Funciones Dinámicas, Helpers (sin cambios) ---
        let objetivoCounter = 0; function generateUniqueId(prefix) { return `${prefix}_${Date.now()}_${Math.random().toString(36).substring(2, 7)}`; }
        function addObjetivo() { objetivoCounter++; const container = document.getElementById('objetivosContainer'); const uniqueId = generateUniqueId('objetivo'); const displayNum = container.querySelectorAll('.objetivo-block').length + 1; const objetivoDiv = document.createElement('div'); objetivoDiv.classList.add('objetivo-block'); objetivoDiv.setAttribute('id', uniqueId); objetivoDiv.setAttribute('data-display-num', displayNum); objetivoDiv.innerHTML = ` <div class="flex justify-between items-start mb-2"> <label for="${uniqueId}_input" class="block font-semibold text-gray-700 text-md flex items-center"> Objetivo Estratégico ${displayNum}: <button type="button" class="btn-icon verb-list-button" data-level="objetivo" title="Ver verbos sugeridos"><i data-lucide="list"></i></button> </label> <button type="button" onclick="removeElement('${uniqueId}', 'objetivo')" class="dynamic-remove-button" title="Eliminar Objetivo ${displayNum} y todo su contenido"><i data-lucide="trash-2"></i></button> </div> <input type="text" id="${uniqueId}_input" name="${uniqueId}_input" class="form-input w-full mb-3" placeholder="QUÉ lograr (SMART: Medible y Plazo)..."> <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 optional-field-group"> <div> <label for="${uniqueId}_kpi" class="block">KPI Principal (Opcional):</label> <input type="text" id="${uniqueId}_kpi" name="${uniqueId}_kpi" class="form-input w-full" placeholder="Ej: % Crecimiento Ventas"> </div> <div> <label for="${uniqueId}_resp" class="block">Responsable (Opcional):</label> <input type="text" id="${uniqueId}_resp" name="${uniqueId}_resp" class="form-input w-full" placeholder="Ej: Gerencia Comercial"> </div> </div> <div id="estrategias_${uniqueId}" class="estrategias-container mt-4"></div> <button type="button" onclick="addEstrategia('${uniqueId}')" class="dynamic-add-button bg-blue-500 hover:bg-blue-600"> <i data-lucide="plus-circle"></i> Añadir Estrategia </button> `; container.appendChild(objetivoDiv); updateNumbers('objetivo'); lucide.createIcons(); }
        function addEstrategia(objetivoId) { const objetivoBlock = document.getElementById(objetivoId); if (!objetivoBlock) return; const objetivoDisplayNum = objetivoBlock.getAttribute('data-display-num'); const container = document.getElementById(`estrategias_${objetivoId}`); if (!container) return; const uniqueId = generateUniqueId(`estrategia_${objetivoId}`); const displayNum = container.querySelectorAll('.estrategia-block').length + 1; const estrategiaDiv = document.createElement('div'); estrategiaDiv.classList.add('estrategia-block'); estrategiaDiv.setAttribute('id', uniqueId); estrategiaDiv.setAttribute('data-display-num', displayNum); estrategiaDiv.setAttribute('data-parent-id', objetivoId); estrategiaDiv.innerHTML = ` <div class="flex justify-between items-start mb-1"> <label for="${uniqueId}_input" class="block text-sm font-semibold text-gray-600 flex items-center"> Estrategia ${objetivoDisplayNum}.${displayNum}: <button type="button" class="btn-icon verb-list-button" data-level="estrategia" title="Ver verbos sugeridos"><i data-lucide="list"></i></button> </label> <button type="button" onclick="removeElement('${uniqueId}', 'estrategia')" class="dynamic-remove-button" title="Eliminar Estrategia ${objetivoDisplayNum}.${displayNum}"><i data-lucide="trash-2"></i></button> </div> <input type="text" id="${uniqueId}_input" name="${uniqueId}_input" class="form-input w-full mb-2" placeholder="CÓMO lograrlo (Enfoque)..."> <div id="tacticas_${uniqueId}" class="tacticas-container mt-3"></div> <button type="button" onclick="addTactica('${uniqueId}')" class="dynamic-add-button bg-gray-600 hover:bg-gray-700"> <i data-lucide="plus-circle"></i> Añadir Táctica </button> `; container.appendChild(estrategiaDiv); updateNumbers('estrategia', objetivoId); lucide.createIcons(); }
        function addTactica(estrategiaId) { const estrategiaBlock = document.getElementById(estrategiaId); if (!estrategiaBlock) return; const objetivoId = estrategiaBlock.getAttribute('data-parent-id'); const objetivoBlock = document.getElementById(objetivoId); if (!objetivoBlock) return; const objetivoDisplayNum = objetivoBlock.getAttribute('data-display-num'); const estrategiaDisplayNum = estrategiaBlock.getAttribute('data-display-num'); const container = document.getElementById(`tacticas_${estrategiaId}`); if (!container) return; const uniqueId = generateUniqueId(`tactica_${estrategiaId}`); const displayNum = container.querySelectorAll('.tactica-block').length + 1; const tacticaDiv = document.createElement('div'); tacticaDiv.classList.add('tactica-block'); tacticaDiv.setAttribute('id', uniqueId); tacticaDiv.setAttribute('data-display-num', displayNum); tacticaDiv.setAttribute('data-parent-id', estrategiaId); tacticaDiv.innerHTML = ` <div class="flex justify-between items-start mb-1"> <label for="${uniqueId}_input" class="block text-xs font-semibold text-gray-500 flex items-center"> Táctica ${objetivoDisplayNum}.${estrategiaDisplayNum}.${displayNum}: <button type="button" class="btn-icon verb-list-button" data-level="tactica" title="Ver verbos sugeridos"><i data-lucide="list"></i></button> </label> <button type="button" onclick="removeElement('${uniqueId}', 'tactica')" class="dynamic-remove-button" title="Eliminar Táctica ${objetivoDisplayNum}.${estrategiaDisplayNum}.${displayNum}"><i data-lucide="trash-2"></i></button> </div> <input type="text" id="${uniqueId}_input" name="${uniqueId}_input" class="form-input w-full mb-2" placeholder="Acción concreta..."> <div id="actividades_${uniqueId}" class="actividades-container mt-3"></div> <button type="button" onclick="addActividad('${uniqueId}')" class="dynamic-add-button bg-gray-500 hover:bg-gray-600"> <i data-lucide="plus-circle"></i> Añadir Actividad </button> `; container.appendChild(tacticaDiv); updateNumbers('tactica', estrategiaId); lucide.createIcons(); }
        function addActividad(tacticaId) { const tacticaBlock = document.getElementById(tacticaId); if (!tacticaBlock) return; const estrategiaId = tacticaBlock.getAttribute('data-parent-id'); const estrategiaBlock = document.getElementById(estrategiaId); if (!estrategiaBlock) return; const objetivoId = estrategiaBlock.getAttribute('data-parent-id'); const objetivoBlock = document.getElementById(objetivoId); if (!objetivoBlock) return; const objetivoDisplayNum = objetivoBlock.getAttribute('data-display-num'); const estrategiaDisplayNum = estrategiaBlock.getAttribute('data-display-num'); const tacticaDisplayNum = tacticaBlock.getAttribute('data-display-num'); const container = document.getElementById(`actividades_${tacticaId}`); if (!container) return; const uniqueId = generateUniqueId(`actividad_${tacticaId}`); const displayNum = container.querySelectorAll('.actividad-block').length + 1; const actividadDiv = document.createElement('div'); actividadDiv.classList.add('actividad-block'); actividadDiv.setAttribute('id', uniqueId); actividadDiv.setAttribute('data-display-num', displayNum); actividadDiv.setAttribute('data-parent-id', tacticaId); actividadDiv.innerHTML = ` <div class="flex items-center justify-between mb-1"> <label for="${uniqueId}_input" class="block text-xs font-medium text-gray-500 flex items-center"> Actividad ${objetivoDisplayNum}.${estrategiaDisplayNum}.${tacticaDisplayNum}.${displayNum}: <button type="button" class="btn-icon verb-list-button" data-level="actividad" title="Ver verbos sugeridos"><i data-lucide="list"></i></button> </label> <button type="button" onclick="removeElement('${uniqueId}', 'actividad')" class="dynamic-remove-button" title="Eliminar Actividad ${objetivoDisplayNum}.${estrategiaDisplayNum}.${tacticaDisplayNum}.${displayNum}"><i data-lucide="trash-2"></i></button> </div> <input type="text" id="${uniqueId}_input" name="${uniqueId}_input" class="form-input w-full text-xs mb-2" placeholder="Tarea (Medible y Plazo)..."> <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 optional-field-group"> <div> <label for="${uniqueId}_kpi" class="block">KPI Principal (Opcional):</label> <input type="text" id="${uniqueId}_kpi" name="${uniqueId}_kpi" class="form-input w-full" placeholder="Ej: # Tareas Completadas"> </div> <div> <label for="${uniqueId}_resp" class="block">Responsable (Opcional):</label> <input type="text" id="${uniqueId}_resp" name="${uniqueId}_resp" class="form-input w-full" placeholder="Ej: Nombre Persona/Equipo"> </div> </div> `; container.appendChild(actividadDiv); updateNumbers('actividad', tacticaId); lucide.createIcons(); }
        function removeElement(id, level) { const element = document.getElementById(id); if (element) { const parentId = element.getAttribute('data-parent-id'); element.remove(); console.log(`[ALINEA Dinámico] Elemento ${id} (nivel ${level}) eliminado.`); if (level === 'objetivo') { updateNumbers('objetivo'); } else if (parentId) { updateNumbers(level, parentId); } } }
        function updateNumbers(level, parentId = null) { let container; let items; let prefix; let labelSelector; let parentNums = {}; switch (level) { case 'objetivo': container = document.getElementById('objetivosContainer'); items = container.querySelectorAll(':scope > .objetivo-block'); prefix = 'Objetivo Estratégico'; labelSelector = 'label[for^="objetivo"]'; break; case 'estrategia': container = document.getElementById(`estrategias_${parentId}`); if (!container) return; items = container.querySelectorAll(':scope > .estrategia-block'); parentNums.objNum = document.getElementById(parentId)?.getAttribute('data-display-num') || '?'; prefix = `Estrategia ${parentNums.objNum}.`; labelSelector = 'label[for^="estrategia"]'; break; case 'tactica': container = document.getElementById(`tacticas_${parentId}`); if (!container) return; items = container.querySelectorAll(':scope > .tactica-block'); const estBlockTac = document.getElementById(parentId); const objIdTac = estBlockTac?.getAttribute('data-parent-id'); parentNums.objNum = document.getElementById(objIdTac)?.getAttribute('data-display-num') || '?'; parentNums.estNum = estBlockTac?.getAttribute('data-display-num') || '?'; prefix = `Táctica ${parentNums.objNum}.${parentNums.estNum}.`; labelSelector = 'label[for^="tactica"]'; break; case 'actividad': container = document.getElementById(`actividades_${parentId}`); if (!container) return; items = container.querySelectorAll(':scope > .actividad-block'); const tacBlockAct = document.getElementById(parentId); const estIdAct = tacBlockAct?.getAttribute('data-parent-id'); const estBlockAct = document.getElementById(estIdAct); const objIdAct = estBlockAct?.getAttribute('data-parent-id'); parentNums.objNum = document.getElementById(objIdAct)?.getAttribute('data-display-num') || '?'; parentNums.estNum = estBlockAct?.getAttribute('data-display-num') || '?'; parentNums.tacNum = tacBlockAct?.getAttribute('data-display-num') || '?'; prefix = `Actividad ${parentNums.objNum}.${parentNums.estNum}.${parentNums.tacNum}.`; labelSelector = 'label[for^="actividad"]'; break; default: return; } if (!items) return; items.forEach((item, index) => { const displayNum = index + 1; item.setAttribute('data-display-num', displayNum); const label = item.querySelector(labelSelector); if (label && label.childNodes.length > 0) { label.childNodes[0].nodeValue = `${prefix}${displayNum}: `; } const removeButton = item.querySelector('.dynamic-remove-button'); if (removeButton) { removeButton.title = `Eliminar ${prefix.replace(':','').trim()} ${displayNum}`; } }); }
        // --- Helper Functions ---
        function isInfinitivo(word) { if (!word) return false; const lowerWord = word.toLowerCase().replace(/[.,:;!¿?()]$/, ''); const infinitiveEndings = ['ar', 'er', 'ir']; for (const ending of infinitiveEndings) { if (lowerWord.endsWith(ending) && lowerWord.length > ending.length) { if (lowerWord.length > 3 || ['ir', 'ser', 'ver'].includes(lowerWord)) { return true; } } } return false; }
        function getStartingInfinitives(text) { if (!text) return []; const words = text.split(' '); const infinitives = []; for (const word of words) { if (isInfinitivo(word)) { infinitives.push(word.toLowerCase().replace(/[.,:;!¿?()]$/, '')); } else { break; } } return infinitives; }
        function extractKeywords(text) { if (!text) return []; const normalizedText = text.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^\w\sñ]/g, '').replace(/\d+/g, ''); return normalizedText.split(/\s+/).filter(word => word.length > 3 && !STOP_WORDS.includes(word)); }
        function isMeasurable(text) { if (!text) return false; const measurablePattern = /(\d+([.,]\d+)?%?)|([€$¢£¥])|(\b(unidades|clientes|puntos|veces|horas|días|meses|kpi|nps|roi|cac|ltv|indicador|meta|cifra|valor|número|cantidad)\b)|(\b(mayor|menor|igual|superior|inferior)\b)|(\b(aumentar|reducir|mantener|incrementar|disminuir|lograr|alcanzar)\s+en\b|\b(llegar\s+a)\b)/i; return measurablePattern.test(text); }
        function isTimeBound(text) { if (!text) return false; const timePattern = /\b(año|mes|trimestre|semestre|semana|día|enero|feb|mar|abr|may|jun|jul|ago|sep|oct|nov|dic|Q[1-4]|S[1-2]|H[1-2]|(20\d{2}))\b|\b(fin de|antes de|para el|durante el|en los próximos|plazo de|fecha límite|al terminar|cuando finalice|a partir de|dentro de)\b|(\d{1,2}[\/-]\d{1,2}([\/-]\d{2,4})?)/i; return timePattern.test(text); }
        function extractYear(text) { if (!text) return null; const yearMatch = text.match(/\b(20\d{2})\b/); return yearMatch ? parseInt(yearMatch[1], 10) : null; }
        function hasLongSentences(text, maxLength = 25) { if (!text) return false; const sentences = text.split(/[.!?]\s+(?=[A-ZÑÁÉÍÓÚ])/); return sentences.some(sentence => sentence.split(/\s+/).length > maxLength); }
        function checkTense(text, expectedTense = 'presente') { if (!text) return { suggestion: null }; const lowerText = text.toLowerCase(); const presentIndicators = /\b(es|son|somos|hace|realiza|ofrece|contribuye|busca|define|permite|facilita|consiste|representa|incluye)\b/i; const futureIndicators = /\b(será|serán|seremos|logrará|alcanzará|permitirá|contribuirá|implementará|desarrollará|buscará|definirá|consolidará|posicionará)\b|(\bfuturo\b)|(\bpara\s+el\s+(año|trimestre|mes)\s+\d{1,4}\b)|(\bpara\s+20\d{2}\b)/i; if (expectedTense === 'presente') { if (futureIndicators.test(lowerText) && !presentIndicators.test(lowerText)) { return { suggestion: "Parece redactada en futuro. La Misión describe el presente." }; } } else if (expectedTense === 'futuro') { if (presentIndicators.test(lowerText) && !futureIndicators.test(lowerText)) { return { suggestion: "Parece redactada en presente. La Visión describe una aspiración futura." }; } } return { suggestion: null }; }
        function getText(id) { const element = document.getElementById(id); if (!element) { console.warn(`[ALINEA] Elemento fijo con ID '${id}' no encontrado.`); return ""; } return element.value.trim(); }

        // --- Funciones Check (MODIFICADAS para highlight positivo) ---
        function collectPlanData() { const data = { organizacion: getText('orgName'), principios: [getText('p1'), getText('p2'), getText('p3')].filter(p => p), politicas: [getText('pol1'), getText('pol2'), getText('pol3')].filter(p => p), mision: getText('mision'), vision: getText('vision'), objetivos: [] }; const objetivoBlocks = document.querySelectorAll('#objetivosContainer > .objetivo-block'); objetivoBlocks.forEach((objBlock) => { const objInput = objBlock.querySelector('input[id$="_input"]'); const objKpiInput = objBlock.querySelector('input[id$="_kpi"]'); const objRespInput = objBlock.querySelector('input[id$="_resp"]'); const objData = { id: objInput?.id || objBlock.id + "_input", texto: objInput?.value.trim() || '', kpi: objKpiInput?.value.trim() || '', responsable: objRespInput?.value.trim() || '', index: parseInt(objBlock.getAttribute('data-display-num') || 0, 10), estrategias: [] }; const estrategiaBlocks = objBlock.querySelectorAll('.estrategias-container > .estrategia-block'); estrategiaBlocks.forEach((estBlock) => { const estInput = estBlock.querySelector('input[id$="_input"]'); const estData = { id: estInput?.id || estBlock.id + "_input", texto: estInput?.value.trim() || '', index: parseInt(estBlock.getAttribute('data-display-num') || 0, 10), tacticas: [] }; const tacticaBlocks = estBlock.querySelectorAll('.tacticas-container > .tactica-block'); tacticaBlocks.forEach((tacBlock) => { const tacInput = tacBlock.querySelector('input[id$="_input"]'); const tacData = { id: tacInput?.id || tacBlock.id + "_input", texto: tacInput?.value.trim() || '', index: parseInt(tacBlock.getAttribute('data-display-num') || 0, 10), actividades: [] }; const actividadBlocks = tacBlock.querySelectorAll('.actividades-container > .actividad-block'); actividadBlocks.forEach((actBlock) => { const actInput = actBlock.querySelector('input[id$="_input"]'); const actKpiInput = actBlock.querySelector('input[id$="_kpi"]'); const actRespInput = actBlock.querySelector('input[id$="_resp"]'); if (actInput) { tacData.actividades.push({ id: actInput.id, texto: actInput.value.trim(), kpi: actKpiInput?.value.trim() || '', responsable: actRespInput?.value.trim() || '', index: parseInt(actBlock.getAttribute('data-display-num') || 0, 10) }); } }); estData.tacticas.push(tacData); }); objData.estrategias.push(estData); }); data.objetivos.push(objData); }); return data; }
        function checkCompleteness(data, feedback) { if (!data.organizacion) feedback.push({ type: 'warning', text: "⚠️ Falta nombre organización.", elementId: 'orgName' }); if (!data.mision) feedback.push({ type: 'warning', text: "⚠️ Falta Misión.", elementId: 'mision' }); if (!data.vision) feedback.push({ type: 'warning', text: "⚠️ Falta Visión.", elementId: 'vision' }); if (data.principios.length === 0) feedback.push({ type: 'suggestion', text: "💡 Definir Principio/Valor.", elementId: 'p1' }); if (data.politicas.length === 0) feedback.push({ type: 'suggestion', text: "💡 Definir Políticas.", elementId: 'pol1' }); if (data.objetivos.length === 0) { feedback.push({ type: 'warning', text: "⚠️ No hay Objetivos Estratégicos." }); return; } data.objetivos.forEach((obj) => { if (!obj.texto) { feedback.push({ type: 'warning', text: `⚠️ Objetivo ${obj.index}: Falta texto.`, elementId: obj.id }); } if (obj.estrategias.length === 0 && obj.texto) { feedback.push({ type: 'warning', text: `⚠️ Objetivo ${obj.index}: Sin estrategias.`, elementId: obj.id }); } obj.estrategias.forEach((est) => { if (!est.texto) { feedback.push({ type: 'warning', text: `⚠️ Obj ${obj.index}>Est ${est.index}: Falta texto.`, elementId: est.id }); } if (est.tacticas.length === 0 && est.texto) { feedback.push({ type: 'warning', text: `⚠️ Obj ${obj.index}>Est ${est.index}: Sin tácticas.`, elementId: est.id }); } est.tacticas.forEach((tac) => { if (!tac.texto) { feedback.push({ type: 'warning', text: `⚠️ Obj ${obj.index}>Est ${est.index}>Tac ${tac.index}: Falta texto.`, elementId: tac.id }); } if (tac.actividades.length === 0 && tac.texto) { feedback.push({ type: 'warning', text: `⚠️ Obj ${obj.index}>Est ${est.index}>Tac ${tac.index}: Sin actividades.`, elementId: tac.id }); } tac.actividades.forEach((act) => { if (!act.texto) { feedback.push({ type: 'warning', text: `⚠️ Obj ${obj.index}>Est ${est.index}>Tac ${tac.index}>Act ${act.index}: Falta texto.`, elementId: act.id }); } }); }); }); }); }
        function checkFormatoClaridad(data, feedback) { const orgName = data.organizacion; const visionYear = extractYear(data.vision); if (orgName) { if (data.mision && !data.mision.toLowerCase().includes(orgName.toLowerCase())) { feedback.push({ type: 'suggestion', text: `💡 Misión: Considera incluir nombre ('${orgName}').`, elementId: 'mision' }); } if (data.vision && !data.vision.toLowerCase().includes(orgName.toLowerCase())) { feedback.push({ type: 'suggestion', text: `💡 Visión: Considera incluir nombre ('${orgName}').`, elementId: 'vision' }); } } const missionTenseCheck = checkTense(data.mision, 'presente'); if (missionTenseCheck.suggestion) { feedback.push({ type: 'suggestion', text: `💡 Misión: ${missionTenseCheck.suggestion}`, elementId: 'mision' }); } const visionTenseCheck = checkTense(data.vision, 'futuro'); if (visionTenseCheck.suggestion) { feedback.push({ type: 'suggestion', text: `💡 Visión: ${visionTenseCheck.suggestion}`, elementId: 'vision' }); } if (data.vision && !visionYear) { feedback.push({ type: 'suggestion', text: "💡 Visión: No se detecta año objetivo (ej. 2028).", elementId: 'vision' }); }
            const checkElement = (item, elementName, level, parentData = null, visionYear = null) => {
                const text = item.texto;
                const elementId = item.id;
                if (!text) return null;

                let isPositive = true; // Flag para rastrear si hay negativos que eviten el verde
                const inputElement = document.getElementById(elementId); // Obtener referencia al elemento input/textarea

                const words = text.split(' ');
                const startingInfinitives = getStartingInfinitives(text);
                const firstWord = words.length > 0 ? words[0].toLowerCase() : "";
                const verb = startingInfinitives.length > 0 ? startingInfinitives[0] : null;
                const expectedVerbs = ACTION_VERBS[level] || [];
                let elementYear = null;
                let hasLaterInfinitive = false;

                if (firstWord === "bienestar") {
                    feedback.push({ type: 'warning', text: `⚠️ ${elementName}: Inicia con 'bienestar', no es verbo infinitivo.`, elementId: elementId });
                    isPositive = false;
                }

                if (words.length > 1) { for (let i = 1; i < words.length; i++) { if (isInfinitivo(words[i])) { hasLaterInfinitive = true; break; } } }

                if (startingInfinitives.length > 1) {
                    feedback.push({ type: 'warning', text: `⚠️ ${elementName}: Inicia con >1 verbo (${startingInfinitives.join(', ')}).`, elementId: elementId });
                    isPositive = false;
                } else if (startingInfinitives.length === 0 && firstWord !== "bienestar") {
                    feedback.push({ type: 'warning', text: `⚠️ ${elementName}: Debe iniciar con UN verbo infinitivo apropiado.`, elementId: elementId });
                    isPositive = false;
                } else if (verb) {
                    if (!expectedVerbs.includes(verb)) {
                        feedback.push({ type: 'suggestion', text: `💡 ${elementName}: Verbo '${verb}' no está en la lista sugerida para ${level}.`, elementId: elementId });
                        // No marcamos como negativo por esto, es sugerencia, pero sí evita el verde explícito del verbo
                    } else {
                         // Si el verbo es correcto, NO añadimos feedback positivo aquí, esperamos al final
                         console.log(`[ALINEA Check Verb] Verbo '${verb}' en ${elementName} aceptado.`);
                    }
                    if (hasLaterInfinitive) {
                        feedback.push({ type: 'warning', text: `⚠️ ${elementName}: Contiene infinitivos después del verbo principal ('${verb}').`, elementId: elementId });
                        isPositive = false; // Consideramos esto negativo
                    }
                }

                 // Revisión de cláusulas de propósito (se hace en checkProposito, aquí solo marcamos negativo si las hay)
                 if (text && FORBIDDEN_PHRASES.some(phrase => {
                     if (phrase === " para ") {
                         const regexPara = /\spara\s+(?![.,;!?)])/i; // Busca " para " no seguido de puntuación
                         return regexPara.test(text);
                     }
                     return text.toLowerCase().includes(phrase);
                 })) {
                    isPositive = false; // Marcar como no positivo si hay frases prohibidas
                 }


                if (level === 'objetivo' || level === 'actividad') {
                    elementYear = extractYear(text);
                    const measurable = isMeasurable(text);
                    const timeBound = isTimeBound(text);
                    let smartIssues = false; // Flag específico para SMART
                    let smartFeedback = [];
                    if (!measurable) { smartFeedback.push("indicador MEDIBLE"); smartIssues = true; }
                    if (!timeBound) { smartFeedback.push("PLAZO definido"); smartIssues = true; }

                    if (smartIssues) {
                        feedback.push({ type: 'warning', text: `⚠️ ${elementName}: Requiere ${smartFeedback.join(' y ')}.`, elementId: elementId });
                        isPositive = false; // Fallar SMART es negativo
                    }

                    if (level === 'objetivo' && elementYear && visionYear && elementYear > visionYear) {
                        feedback.push({ type: 'suggestion', text: `💡 ${elementName}: Año (${elementYear}) posterior a Visión (${visionYear}).`, elementId: elementId });
                        // Esto es sugerencia, no necesariamente negativo para el borde verde.
                    }
                    if (level === 'actividad' && elementYear && parentData?.year && elementYear > parentData.year) {
                        feedback.push({ type: 'suggestion', text: `💡 ${elementName}: Año (${elementYear}) posterior a Objetivo (${parentData.year}).`, elementId: parentData.id });
                        // Sugerencia, no necesariamente negativo.
                    }
                }

                checkVagueness(text, elementName, feedback, elementId); // Vagueness genera sugerencia, no impide verde por sí sola
                if (hasLongSentences(text, (level === 'objetivo' || level === 'estrategia' ? 30 : 20))) {
                    feedback.push({ type: 'suggestion', text: `💡 ${elementName}: Contiene frases largas. Considera simplificar.`, elementId: elementId });
                     // Sugerencia, no impide verde por sí sola
                }

                if (level === 'objetivo' || level === 'actividad') {
                    if (!item.kpi) { feedback.push({ type: 'suggestion', text: `💡 ${elementName}: Considera definir un KPI principal.`, elementId: elementId.replace('_input', '_kpi') }); }
                    if (!item.responsable) { feedback.push({ type: 'suggestion', text: `💡 ${elementName}: Considera asignar un Responsable.`, elementId: elementId.replace('_input', '_resp') }); }
                }

                // --- Lógica final para borde verde ---
                // Aplica clase positiva solo si el flag isPositive sigue en true
                 if (inputElement) {
                    if (isPositive) {
                         // Antes de añadir positivo, una última comprobación explícita por si acaso
                         const hasWarning = feedback.some(f => f.elementId === elementId && f.type === 'warning');
                         if (!hasWarning) { // Solo añadimos verde si NO hay warnings explícitos para este elemento
                             inputElement.classList.add('input-positive');
                         } else {
                            inputElement.classList.remove('input-positive'); // Asegura quitarlo si hay warning
                         }
                    } else {
                         inputElement.classList.remove('input-positive'); // Quita verde si isPositive es false
                    }
                 }

                return elementYear;
            }; // Fin de checkElement

            data.objetivos.forEach((obj) => { const objName = `Objetivo ${obj.index}`; const objYear = checkElement(obj, objName, 'objetivo', null, visionYear); const objectiveDataForChildren = { year: objYear, id: obj.id }; obj.estrategias.forEach((est) => { const estName = `Obj. ${obj.index} > Estrategia ${est.index}`; checkElement(est, estName, 'estrategia'); est.tacticas.forEach((tac) => { const tacName = `Obj. ${obj.index} > Est. ${est.index} > Táctica ${tac.index}`; checkElement(tac, tacName, 'tactica'); tac.actividades.forEach((act) => { const actName = `Obj. ${obj.index} > Est. ${est.index} > Tác. ${tac.index} > Actividad ${act.index}`; checkElement(act, actName, 'actividad', objectiveDataForChildren); }); }); }); });
            data.principios.forEach((p, i) => { checkElementPrincipioPol(p, `p${i+1}`, `Principio ${i+1}`, feedback); });
            data.politicas.forEach((pol, i) => { checkElementPrincipioPol(pol, `pol${i+1}`, `Política ${i+1}`, feedback, true); });
        }
        function checkProposito(data, feedback) { const checkTextForPurpose = (text, elementName, elementId) => { if (!text) return; let foundForbidden = false; FORBIDDEN_PHRASES.forEach(phrase => { let found = false; if (phrase === " para ") { const regexPara = /\spara\s+(?![.,;!?)])/i; if (regexPara.test(text)) { found = true; } } else if (text.toLowerCase().includes(phrase)) { found = true; } if (found) { feedback.push({ type: 'warning', text: `⚠️ ${elementName}: Contiene cláusula de propósito ('${phrase.trim()}'). Reformula centrándote en la acción principal.`, elementId: elementId }); foundForbidden = true; } }); return foundForbidden; }; data.objetivos.forEach(obj => { checkTextForPurpose(obj.texto, `Objetivo ${obj.index}`, obj.id); obj.estrategias.forEach(est => { checkTextForPurpose(est.texto, `Obj. ${obj.index} > Estrategia ${est.index}`, est.id); est.tacticas.forEach(tac => { checkTextForPurpose(tac.texto, `Obj. ${obj.index} > Est. ${est.index} > Táctica ${tac.index}`, tac.id); tac.actividades.forEach(act => { checkTextForPurpose(act.texto, `Obj. ${obj.index} > Est. ${est.index} > Tác. ${tac.index} > Actividad ${act.index}`, act.id); }); }); }); }); }
        function checkElementPrincipioPol(text, elementId, elementName, feedback, isPolicy = false) { if (!text) return; const startingInfinitives = getStartingInfinitives(text); if (!isPolicy) { if (startingInfinitives.length > 0) { feedback.push({ type: 'suggestion', text: `💡 ${elementName}: Parece iniciar con verbo(s). Principios son conceptos abstractos.`, elementId: elementId }); } } else { if (!/\b(política|norma|directriz|procedimiento|regla|código|guía)\b/i.test(text.toLowerCase()) && text.split(/\s+/).length < 5) { feedback.push({ type: 'suggestion', text: `💡 ${elementName}: Redacción breve/sin términos clave ('política', 'norma'...). Asegura que sea directriz.`, elementId: elementId }); } } }
        function checkVagueness(text, elementName, feedback, elementId) { if (!text) return; const lowerText = text.toLowerCase(); let vagueFound = []; VAGUE_WORDS.forEach(word => { const regex = new RegExp(`\\b${word}\\b`, 'i'); if (regex.test(lowerText)) { vagueFound.push(word); } }); if (vagueFound.length > 0) { feedback.push({ type: 'suggestion', text: `💡 ${elementName}: Contiene '${vagueFound.join(', ')}'. Considera mayor especificidad.`, elementId: elementId }); } }
        function checkCoherenciaVertical(data, feedback) { const checkOverlap = (keywords1, keywords2) => { if (!keywords1 || !keywords2 || keywords1.length === 0 || keywords2.length === 0) return 0; const set2 = new Set(keywords2); const intersection = keywords1.filter(kw => set2.has(kw)); return intersection.length; }; data.objetivos.forEach((obj) => { if (!obj.texto) return; const objKeywords = extractKeywords(obj.texto); const objName = `Objetivo ${obj.index}`; obj.estrategias.forEach((est) => { if (!est.texto) return; const estKeywords = extractKeywords(est.texto); const estName = `Estrategia ${obj.index}.${est.index}`; const overlapOE = checkOverlap(objKeywords, estKeywords); if (overlapOE === 0 && objKeywords.length > 0 && estKeywords.length > 0) { feedback.push({ type: 'suggestion', text: `💡 ${estName} y ${objName}: Sin conexión léxica clara. ¿Estrategia responde a objetivo?`, elementId: est.id }); } est.tacticas.forEach((tac) => { if (!tac.texto) return; const tacKeywords = extractKeywords(tac.texto); const tacName = `Táctica ${obj.index}.${est.index}.${tac.index}`; const overlapET = checkOverlap(estKeywords, tacKeywords); if (overlapET === 0 && estKeywords.length > 0 && tacKeywords.length > 0) { feedback.push({ type: 'suggestion', text: `💡 ${tacName} y ${estName}: Sin conexión léxica clara. ¿Táctica detalla estrategia?`, elementId: tac.id }); } tac.actividades.forEach((act) => { if (!act.texto) return; const actKeywords = extractKeywords(act.texto); const actName = `Actividad ${obj.index}.${est.index}.${tac.index}.${act.index}`; const overlapTA = checkOverlap(tacKeywords, actKeywords); if (overlapTA === 0 && tacKeywords.length > 0 && actKeywords.length > 0) { feedback.push({ type: 'suggestion', text: `💡 ${actName} y ${tacName}: Sin conexión léxica clara. ¿Actividad concreta la táctica?`, elementId: act.id }); } }); }); }); }); }
        function checkAlineacionTeleologica(data, feedback) { const checkOverlap = (keywords1, keywords2) => { if (!keywords1 || !keywords2 || keywords1.length === 0 || keywords2.length === 0) return 0; const set2 = new Set(keywords2); const intersection = keywords1.filter(kw => set2.has(kw)); return intersection.length; }; const misionKeywords = extractKeywords(data.mision); const visionKeywords = extractKeywords(data.vision); let objKeywordsAll = data.objetivos.flatMap(obj => obj.texto ? extractKeywords(obj.texto) : []); objKeywordsAll = [...new Set(objKeywordsAll)]; if (data.mision && misionKeywords.length > 0 && objKeywordsAll.length > 0 && checkOverlap(misionKeywords, objKeywordsAll) === 0) { feedback.push({ type: 'suggestion', text: "💡 Objetivos y Misión: Sin conexión léxica fuerte. ¿Objetivos contribuyen a razón de ser?", elementId: 'mision' }); } if (data.vision && visionKeywords.length > 0 && objKeywordsAll.length > 0 && checkOverlap(visionKeywords, objKeywordsAll) === 0) { feedback.push({ type: 'suggestion', text: "💡 Objetivos y Visión: Sin conexión léxica fuerte. ¿Objetivos apuntan a aspiración futura?", elementId: 'vision' }); } }

        // --- Display Functions (MODIFICADAS) ---
        function clearInputHighlights() {
            // Limpia clases de los campos fijos
            ['orgName', 'p1', 'p2', 'p3', 'pol1', 'pol2', 'pol3', 'mision', 'vision'].forEach(id => {
                const e = document.getElementById(id);
                if(e) e.classList.remove('input-warning', 'input-suggestion', 'input-positive'); // Añadido input-positive
            });
            // Limpia clases de los campos dinámicos
            document.querySelectorAll('#objetivosContainer input, #objetivosContainer textarea').forEach(i =>
                i.classList.remove('input-warning', 'input-suggestion', 'input-positive') // Añadido input-positive
            );
        }

        function displayAnalysisResults(feedbackList) {
            const feedbackArea = document.getElementById('feedbackArea');
            const feedbackFooter = document.getElementById('feedbackFooter');
            const planFooter = document.getElementById('planFooter');
            if (!feedbackArea || !feedbackFooter || !planFooter) { console.error("Elementos de salida no encontrados."); return; }

            clearInputHighlights(); // Limpia resaltados ANTES de aplicar nuevos

            feedbackArea.value = '';
            feedbackFooter.innerHTML = ''; feedbackFooter.style.display = 'none';
            planFooter.innerHTML = ''; planFooter.style.display = 'none';

            const uniqueFeedbackKeys = new Set();
            const uniqueFeedbackList = feedbackList.filter(item => {
                const key = `${item.type}-${item.elementId}-${item.text}`; // Clave única
                if (uniqueFeedbackKeys.has(key)) {
                    return false;
                } else {
                    uniqueFeedbackKeys.add(key);
                    return true;
                }
            });

            let feedbackTextOutput = '';
            if (uniqueFeedbackList.filter(f => f.type === 'warning' || f.type === 'suggestion').length === 0) { // Modificado: solo considera negativos para este mensaje
                 feedbackTextOutput = `✅ ¡Excelente! No se encontraron advertencias o sugerencias automáticas significativas...\n\nRecomendación final: Revisa manualmente la coherencia general y adecuación al contexto.`;
                 // Aplica borde verde a todos los elementos si no hay feedback negativo
                 document.querySelectorAll('.form-input, .form-textarea').forEach(el => {
                     if (!el.readOnly) { // No resaltar áreas de salida
                         el.classList.add('input-positive');
                     }
                 });
            } else {
                 const warnings = uniqueFeedbackList.filter(f => f.type === 'warning');
                 const suggestions = uniqueFeedbackList.filter(f => f.type === 'suggestion');
                 // Nota: Los positivos ya no se filtran/muestran aquí

                 feedbackTextOutput = 'Resultados del análisis:\n\n';

                 // Aplicar clases de warning/suggestion (esto puede sobreescribir .input-positive si hay conflicto)
                 uniqueFeedbackList.forEach(f => {
                    if (f.elementId) {
                        const inputElement = document.getElementById(f.elementId);
                        if (inputElement && (inputElement.tagName === 'INPUT' || inputElement.tagName === 'TEXTAREA')) {
                             // Asegurarse de quitar la clase positiva si hay warning o suggestion
                             inputElement.classList.remove('input-positive');
                            if (f.type === 'warning') {
                                inputElement.classList.add('input-warning');
                            } else if (f.type === 'suggestion') {
                                inputElement.classList.add('input-suggestion');
                            }
                        }
                    }
                 });

                 if (warnings.length > 0) {
                    feedbackTextOutput += '--- ⚠️ Puntos Críticos: ---\n';
                    warnings.forEach(f => { feedbackTextOutput += `${f.text}\n\n`; });
                 }
                 if (suggestions.length > 0) {
                    feedbackTextOutput += '--- 💡 Sugerencias: ---\n';
                    suggestions.forEach(f => { feedbackTextOutput += `${f.text}\n\n`; });
                 }
                 // SE ELIMINÓ LA SECCIÓN DE POSITIVOS ✅

                 feedbackTextOutput += '\n(Recuerda: Sugerencias automáticas. Aplica tu criterio profesional.)';
            }

            feedbackArea.value = feedbackTextOutput.trim();
            feedbackFooter.textContent = CITATION_TEXT; feedbackFooter.style.display = 'block';
            planFooter.textContent = CITATION_TEXT; planFooter.style.display = 'block';
            console.log("[ALINEA] Resultados del análisis mostrados.");
        }

        function generateFormattedPlan() { const planArea = document.getElementById('planArea'); if (!planArea) { console.error("Elemento 'planArea' no encontrado."); return; } const data = collectPlanData(); let planText = `** Plan Estratégico: ${data.organizacion || 'Sin Nombre'} **\n\n`; planText += `Misión:\n${data.mision || "-"}\n\n`; planText += `Visión:\n${data.vision || "-"}\n\n`; if (data.principios.length > 0) { planText += "Principios / Valores:\n"; data.principios.forEach(p => { planText += `- ${p}\n`; }); planText += "\n"; } if (data.politicas.length > 0) { planText += "Políticas:\n"; data.politicas.forEach(p => { planText += `- ${p}\n`; }); planText += "\n"; } planText += "** Alineación Estratégica **\n\n"; if (data.objetivos.length === 0) { planText += "(No se han definido objetivos)\n"; } data.objetivos.forEach((obj) => { planText += `Objetivo Estratégico ${obj.index}: ${obj.texto || "(Texto no definido)"}\n`; if (obj.kpi) { planText += `  * KPI: ${obj.kpi}\n`; } if (obj.responsable) { planText += `  * Responsable: ${obj.responsable}\n`; } if (obj.estrategias.length === 0) { planText += `  (Sin estrategias definidas)\n`; } obj.estrategias.forEach((est) => { planText += `  Estrategia ${obj.index}.${est.index}: ${est.texto || "(Texto no definido)"}\n`; if (est.tacticas.length === 0) { planText += `    (Sin tácticas definidas)\n`; } est.tacticas.forEach((tac) => { planText += `    Táctica ${obj.index}.${est.index}.${tac.index}: ${tac.texto || "(Texto no definido)"}\n`; if (tac.actividades.length === 0) { planText += `      (Sin actividades definidas)\n`; } tac.actividades.forEach((act) => { planText += `      Actividad ${obj.index}.${est.index}.${tac.index}.${act.index}: ${act.texto || "(Texto no definido)"}\n`; if (act.kpi) { planText += `        * KPI: ${act.kpi}\n`; } if (act.responsable) { planText += `        * Responsable: ${act.responsable}\n`; } }); }); }); planText += "\n"; }); planArea.value = planText.trim(); console.log("[ALINEA] Plan estratégico formulado generado."); }

        // --- Main Analysis Function ---
        function analizarPlan() {
            console.log("[ALINEA] Iniciando análisis...");
            try {
                const data = collectPlanData();
                let feedbackList = []; // Reiniciar feedback en cada análisis

                // Ejecutar todas las funciones de chequeo
                checkCompleteness(data, feedbackList);
                checkFormatoClaridad(data, feedbackList); // Esta ahora intenta añadir .input-positive
                checkProposito(data, feedbackList); // Puede añadir warnings
                checkCoherenciaVertical(data, feedbackList); // Añade suggestions
                checkAlineacionTeleologica(data, feedbackList); // Añade suggestions

                // Mostrar resultados (esta función AHORA maneja la lógica final de qué clase mostrar)
                displayAnalysisResults(feedbackList);
                generateFormattedPlan();
                console.log("[ALINEA] Análisis completado.");
            } catch (error) {
                console.error("Error análisis:", error);
                const feedbackArea = document.getElementById('feedbackArea');
                if(feedbackArea) {
                    feedbackArea.value = `⚠️ Error inesperado. Revisa consola (F12).\n\n${error.message}\n${error.stack}`;
                }
            }
        }

        // --- Modal & Copy Functions (sin cambios) ---
        function openVerbModal(level) { const modal=document.getElementById('verbModal'); const title=document.getElementById('modalTitle'); const list=document.getElementById('modalVerbList'); if (!modal || !title || !list) return; const verbs=ACTION_VERBS[level] || []; const levelTitles={objetivo:"Objetivo Estratégico", estrategia:"Estrategia", tactica:"Táctica", actividad:"Actividad"}; title.textContent=`Verbos Sugeridos para ${levelTitles[level]||'Elemento'}`; list.innerHTML=verbs.length > 0 ? verbs.map(verb => `<span>${verb}</span>`).join(' '):'No hay verbos sugeridos.'; modal.classList.add('visible'); try { lucide.createIcons(); } catch(e){} }
        function closeModal() { const modal = document.getElementById('verbModal'); if (modal) { modal.classList.remove('visible'); } }
        async function copyToClipboard(elementId) { console.log(`[Copy] Desde: ${elementId}`); const contentElement = document.getElementById(elementId); const button = document.getElementById(`copy${elementId.charAt(0).toUpperCase() + elementId.slice(1)}Button`); if (!contentElement) { console.error(`[Copy] Elemento ${elementId} no encontrado.`); return; } let textToCopy = ''; let addCitation = false; if (contentElement.tagName === 'TEXTAREA') { textToCopy = (contentElement.value || '').trim(); if (elementId === 'feedbackArea' || elementId === 'planArea') { addCitation = true; } } else if (contentElement.tagName === 'DIV') { const tempDiv = document.createElement('div'); tempDiv.innerHTML = contentElement.innerHTML || ''; textToCopy = (tempDiv.textContent || tempDiv.innerText || '').replace(/\n\s*\n/g, '\n\n').replace(/^\s+|\s+$/gm, '').trim(); } else { textToCopy = (contentElement.textContent || contentElement.innerText || '').trim(); } if (addCitation && textToCopy) { textToCopy += `\n\n---\n${CITATION_TEXT}`; } else if (addCitation && !textToCopy) { textToCopy = CITATION_TEXT; } if (!navigator.clipboard?.writeText) { alert("Error: Copiar no disponible/permitido (necesita HTTPS o localhost). Copia manualmente (Ctrl+C)."); console.error("[Copy] navigator.clipboard.writeText no disponible."); return; } try { await navigator.clipboard.writeText(textToCopy); console.log(`[Copy] Texto copiado para ${elementId}.`); if (button) { const iconHTML = button.innerHTML; button.innerHTML = `<i data-lucide="check" class="text-green-500"></i>`; button.disabled = true; lucide.createIcons(); setTimeout(() => { button.innerHTML = iconHTML; button.disabled = false; lucide.createIcons(); }, 1500); } } catch (err) { alert(`Error al copiar. Intenta manually (Ctrl+C).\n${err.message}`); console.error('[Copy] Error al copiar:', err); } }

        // --- Initialization & Event Listeners ---
        document.addEventListener('DOMContentLoaded', (event) => {
            console.log("[ALINEA Init] DOM cargado.");
            try { lucide.createIcons(); } catch (error) { console.error("Lucide Error:", error); }
            const conceptualArea = document.getElementById('conceptualArea'); if (conceptualArea) conceptualArea.innerHTML = CONCEPTUAL_HTML_CONTENT;
            const tutorialArea = document.getElementById('tutorialArea'); if (tutorialArea) tutorialArea.innerHTML = TUTORIAL_HTML_CONTENT;
            try { lucide.createIcons(); } catch (e) {} // Re-render icons after adding content

            const analyzeButton = document.getElementById('analyzeButton'); if (analyzeButton) analyzeButton.addEventListener('click', analizarPlan);
            const copyButtons = {'copyFeedbackAreaButton': 'feedbackArea','copyPlanAreaButton': 'planArea','copyConceptualAreaButton': 'conceptualArea','copyTutorialAreaButton': 'tutorialArea'};
            for (const [buttonId, elementId] of Object.entries(copyButtons)) { const button = document.getElementById(buttonId); if (button) button.addEventListener('click', () => copyToClipboard(elementId)); }
            const modalCloseButton = document.getElementById('modalCloseButton'); if (modalCloseButton) modalCloseButton.addEventListener('click', closeModal);
            const modalOverlay = document.getElementById('verbModal'); if (modalOverlay) modalOverlay.addEventListener('click', (e) => { if (e.target === modalOverlay) closeModal(); });
            const mainContainer = document.getElementById('mainAppContainer'); if (mainContainer) mainContainer.addEventListener('click', function(event) { const verbButton = event.target.closest('.verb-list-button'); if (verbButton) { event.preventDefault(); const level = verbButton.getAttribute('data-level'); if (level) openVerbModal(level); } });

            addObjetivo(); // Add the first objective block on load
            console.log("[ALINEA Init] Configuración completa.");
        });

    </script>

</body>
</html>
```